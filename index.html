<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <title>üçî ÌñÑÎ≤ÑÍ±∞ Í∞ÄÍ≤å Í≤åÏûÑ</title>
    <style>
* {
    margin: 0;
    padding: 0;
    box-sizing: border-box;
}

body {
    font-family: 'Press Start 2P', 'Courier New', monospace;
    background: #B8864B;
    overflow: hidden;
    height: 100vh;
    position: relative;
    -webkit-touch-callout: none;
    -webkit-user-select: none;
    user-select: none;
    -webkit-tap-highlight-color: transparent;
    image-rendering: pixelated;
    image-rendering: -moz-crisp-edges;
    image-rendering: crisp-edges;
}

img {
    image-rendering: pixelated;
    image-rendering: -moz-crisp-edges;
    image-rendering: crisp-edges;
}

body::before {
    content: '';
    position: absolute;
    top: 0;
    left: 0;
    right: 0;
    bottom: 0;
    background-image:
        repeating-linear-gradient(
            0deg,
            #8B4513 0px,
            #8B4513 3px,
            #A0522D 3px,
            #A0522D 40px
        );
    background-size: 100% 40px;
    background-color: #CD853F;
}

body::after {
    content: '';
    position: absolute;
    top: 0;
    left: 0;
    right: 0;
    bottom: 0;
    background:
        radial-gradient(circle at 20% 30%, rgba(255,215,0,0.08) 0%, transparent 50%),
        radial-gradient(circle at 80% 70%, rgba(255,140,0,0.08) 0%, transparent 50%),
        radial-gradient(circle at 50% 50%, rgba(255,165,0,0.05) 0%, transparent 70%);
    pointer-events: none;
}

.restaurant-bg {
    position: absolute;
    top: 0;
    left: 0;
    right: 0;
    bottom: 0;
    pointer-events: none;
    z-index: 0;
}

.menu-board {
    position: absolute;
    top: 20px;
    right: 30px;
    width: 160px;
    height: 220px;
    background: linear-gradient(135deg, #1a0f0a 0%, #2c1810 100%);
    border: 8px solid #CD853F;
    border-radius: 12px;
    box-shadow:
        0 15px 40px rgba(0,0,0,0.6),
        inset 0 2px 10px rgba(255,255,255,0.05);
}

.menu-board::before {
    content: 'MENU';
    position: absolute;
    top: 15px;
    left: 50%;
    transform: translateX(-50%);
    color: #FFD700;
    font-size: 2em;
    font-weight: 900;
    text-shadow:
        2px 2px 0 #FF8C00,
        4px 4px 10px rgba(255,215,0,0.5);
    letter-spacing: 4px;
}

.menu-board::after {
    content: 'ÏπòÏ¶àÎ≤ÑÍ±∞\AÎ≤†Ïù¥Ïª® Î≤ÑÍ±∞\AÏÉêÎü¨Îìú';
    white-space: pre;
    position: absolute;
    top: 80px;
    left: 50%;
    transform: translateX(-50%);
    color: #FFA500;
    font-size: 1.1em;
    line-height: 1.5;
    text-shadow: 1px 1px 2px rgba(0,0,0,0.5);
    font-weight: 700;
    text-align: center;
    width: 180px;
}

.lamp {
    position: absolute;
    top: 10px;
    left: 50%;
    transform: translateX(-50%);
    width: 120px;
    height: 70px;
    background: linear-gradient(180deg, #2c2c2c 0%, #3a3a3a 50%, #4a4a4a 100%);
    clip-path: polygon(25% 0%, 75% 0%, 100% 100%, 0% 100%);
    box-shadow:
        0 8px 40px rgba(255,215,0,0.4),
        inset 0 2px 5px rgba(255,255,255,0.1);
    border-radius: 5px;
    display: none;
}

.lamp::before {
    content: '';
    position: absolute;
    top: -10px;
    left: 50%;
    transform: translateX(-50%);
    width: 15px;
    height: 15px;
    background: #2c2c2c;
    border-radius: 50%;
    box-shadow: 0 2px 5px rgba(0,0,0,0.5);
}

.lamp::after {
    content: '';
    position: absolute;
    bottom: -30px;
    left: 50%;
    transform: translateX(-50%);
    width: 300px;
    height: 300px;
    background: radial-gradient(
        ellipse at center,
        rgba(255,235,150,0.3) 0%,
        rgba(255,215,0,0.15) 30%,
        transparent 70%
    );
    animation: lampGlow 3s ease-in-out infinite;
}

@keyframes lampGlow {
    0%, 100% {
        opacity: 1;
    }
    50% {
        opacity: 0.7;
    }
}

.shop-sign {
    display: none;
}

@keyframes signGlow {
    0%, 100% {
        box-shadow:
            0 10px 30px rgba(0,0,0,0.6),
            inset 0 3px 15px rgba(255,255,255,0.4),
            0 0 30px rgba(255,215,0,0.5);
    }
    50% {
        box-shadow:
            0 10px 30px rgba(0,0,0,0.6),
            inset 0 3px 15px rgba(255,255,255,0.4),
            0 0 50px rgba(255,215,0,0.8);
    }
}

.shop-sign::before {
    content: 'BURGER SHOP';
    color: white;
    font-size: 1.3em;
    font-weight: 900;
    text-shadow:
        3px 3px 0 #8B4513,
        -1px -1px 0 #8B4513,
        1px -1px 0 #8B4513,
        -1px 1px 0 #8B4513,
        5px 5px 15px rgba(0,0,0,0.7);
    letter-spacing: 2px;
}

.shop-sign::after {
    content: '‚≠ê';
    position: absolute;
    top: -8px;
    right: -8px;
    font-size: 1.5em;
    color: #FFD700;
    text-shadow: 0 0 15px rgba(255,215,0,1);
    animation: starTwinkle 1.5s infinite;
}

@keyframes starTwinkle {
    0%, 100% {
        opacity: 1;
        transform: rotate(0deg) scale(1);
    }
    50% {
        opacity: 0.5;
        transform: rotate(180deg) scale(1.2);
    }
}

.clock {
    position: absolute;
    top: 100px;
    right: 280px;
    width: 90px;
    height: 90px;
    background: linear-gradient(135deg, #F5F5DC 0%, #E8E8D0 100%);
    border-radius: 50%;
    border: 6px solid #8B4513;
    box-shadow:
        0 8px 25px rgba(0,0,0,0.5),
        inset 0 2px 10px rgba(0,0,0,0.2);
    display: flex;
    align-items: center;
    justify-content: center;
}

.clock::before {
    content: '12';
    position: absolute;
    top: 8px;
    left: 50%;
    transform: translateX(-50%);
    font-size: 0.9em;
    font-weight: bold;
    color: #2c1810;
}

.clock::after {
    content: '';
    position: absolute;
    top: 50%;
    left: 50%;
    width: 2px;
    height: 20px;
    background: #2c1810;
    transform-origin: bottom center;
    transform: translate(-1px, -20px) rotate(90deg);
    border-radius: 2px;
    box-shadow: 0 0 2px rgba(0,0,0,0.5);
}

.game-container {
    width: 100%;
    height: 100vh;
    position: relative;
}

.screen {
    width: 100%;
    height: 100vh;
    display: flex;
    justify-content: center;
    align-items: center;
    position: absolute;
    top: 0;
    left: 0;
}

.screen.hidden {
    display: none;
}

.start-content {
    text-align: center;
    background:
        repeating-linear-gradient(
            45deg,
            transparent,
            transparent 35px,
            rgba(255,140,0,0.03) 35px,
            rgba(255,140,0,0.03) 70px
        ),
        linear-gradient(135deg, #FFF8DC 0%, #FFE4B5 100%);
    padding: 30px 60px;
    border-radius: 30px;
    box-shadow:
        0 20px 60px rgba(0,0,0,0.5),
        0 0 10px #FF6347,
        0 0 20px #FF6347,
        0 0 40px #FF4500,
        inset 0 0 10px rgba(255,99,71,0.2);
    border: 8px solid #FF6347;
    position: relative;
    animation: borderNeonBlink 1.5s infinite alternate;
}

@keyframes borderNeonBlink {
    0%, 19%, 21%, 23%, 25%, 54%, 56%, 100% {
        box-shadow:
            0 20px 60px rgba(0,0,0,0.5),
            0 0 10px #FF6347,
            0 0 20px #FF6347,
            0 0 40px #FF4500,
            0 0 60px #FF4500,
            inset 0 0 10px rgba(255,99,71,0.3);
        border-color: #FF6347;
    }
    20%, 24%, 55% {
        box-shadow:
            0 20px 60px rgba(0,0,0,0.5),
            0 0 5px #FF6347,
            inset 0 0 5px rgba(255,99,71,0.1);
        border-color: #D2691E;
    }
}

.start-content::after {
    content: '';
    position: absolute;
    top: 0;
    left: 0;
    right: 0;
    bottom: 0;
    pointer-events: none;
    z-index: 0;
}

.start-content > * {
    position: relative;
    z-index: 1;
}

.start-content::before {
    content: 'üçî';
    position: absolute;
    top: -50px;
    left: 50%;
    transform: translateX(-50%);
    font-size: 5em;
    filter: drop-shadow(0 10px 20px rgba(0,0,0,0.3));
}

.game-logo {
    font-size: 3em;
    margin-bottom: 15px;
    color: #FF6347;
    text-shadow: 3px 3px 0px #FFA500;
    font-weight: 900;
}

.game-desc {
    font-size: 1.3em;
    color: #666;
    margin-bottom: 25px;
}

.controls-info {
    display: flex;
    gap: 30px;
    justify-content: center;
    margin-bottom: 40px;
    flex-wrap: wrap;
}

.control-item {
    display: flex;
    flex-direction: column;
    align-items: center;
    gap: 10px;
}

.key {
    background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
    color: white;
    padding: 15px 25px;
    border-radius: 10px;
    font-weight: 900;
    font-size: 1.2em;
    box-shadow: 0 5px 15px rgba(0,0,0,0.2);
}

.desc {
    font-size: 0.9em;
    color: #666;
    font-weight: 600;
}

.nickname-input-container {
    margin: 20px 0;
}

.nickname-input {
    padding: 15px 25px;
    font-size: 1.2em;
    border: 3px solid #FF8C00;
    border-radius: 15px;
    background: white;
    color: #333;
    text-align: center;
    width: 280px;
    max-width: 100%;
    font-weight: 600;
    transition: all 0.3s ease;
}

.nickname-input:focus {
    outline: none;
    border-color: #FF6347;
    box-shadow: 0 0 20px rgba(255,99,71,0.3);
}

.nickname-input::placeholder {
    color: #999;
}

.start-btn {
    padding: 20px 60px;
    font-size: 1.5em;
    font-weight: 900;
    background: linear-gradient(135deg, #FF6347 0%, #FFA500 100%);
    color: white;
    border: none;
    border-radius: 50px;
    cursor: pointer;
    transition: all 0.3s ease;
    box-shadow: 0 10px 30px rgba(255,99,71,0.4);
    touch-action: manipulation;
    -webkit-tap-highlight-color: transparent;
    user-select: none;
    margin-bottom: 15px;
}

.start-btn:active {
    transform: scale(0.95);
}

.hall-of-fame-btn {
    padding: 15px 40px;
    font-size: 1.2em;
    font-weight: 700;
    background: linear-gradient(135deg, #FFD700 0%, #FFA500 100%);
    color: #333;
    border: none;
    border-radius: 50px;
    cursor: pointer;
    transition: all 0.3s ease;
    box-shadow: 0 8px 25px rgba(255,215,0,0.4);
    touch-action: manipulation;
    -webkit-tap-highlight-color: transparent;
    user-select: none;
}

.hall-of-fame-btn:active {
    transform: scale(0.95);
}

.hall-of-fame-content {
    background:
        repeating-linear-gradient(
            45deg,
            transparent,
            transparent 35px,
            rgba(255,140,0,0.03) 35px,
            rgba(255,140,0,0.03) 70px
        ),
        linear-gradient(135deg, #FFF8DC 0%, #FFE4B5 100%);
    padding: 30px;
    border-radius: 30px;
    box-shadow: 0 20px 60px rgba(0,0,0,0.5);
    border: 8px solid #D2691E;
    max-width: 600px;
    width: 90%;
    max-height: 80vh;
    overflow-y: auto;
}

.hall-of-fame-title {
    font-size: 2.5em;
    margin-bottom: 30px;
    color: #FF6347;
    text-shadow: 3px 3px 0px #FFA500;
    font-weight: 900;
}

.hall-of-fame-list {
    display: flex;
    flex-direction: column;
    gap: 15px;
    margin-bottom: 30px;
}

.hall-of-fame-item {
    background: linear-gradient(135deg, #FFFFFF 0%, #FFF8DC 100%);
    padding: 20px;
    border-radius: 15px;
    border: 3px solid #D2691E;
    box-shadow: 0 5px 15px rgba(0,0,0,0.2);
    display: flex;
    align-items: center;
    gap: 20px;
}

.hall-of-fame-rank {
    font-size: 2em;
    font-weight: 900;
    color: #FF6347;
    min-width: 50px;
    text-align: center;
}

.hall-of-fame-rank.first {
    color: #FFD700;
    text-shadow: 2px 2px 0px #FFA500;
}

.hall-of-fame-rank.second {
    color: #C0C0C0;
}

.hall-of-fame-rank.third {
    color: #CD7F32;
}

.hall-of-fame-info {
    flex: 1;
}

.hall-of-fame-name {
    font-size: 1.5em;
    font-weight: 700;
    color: #333;
    margin-bottom: 5px;
}

.hall-of-fame-stats {
    display: flex;
    gap: 15px;
    flex-wrap: wrap;
    font-size: 0.9em;
    color: #666;
}

.hall-of-fame-stat {
    display: flex;
    align-items: center;
    gap: 5px;
}

.back-btn {
    padding: 15px 40px;
    font-size: 1.2em;
    font-weight: 700;
    background: linear-gradient(135deg, #8B4513 0%, #D2691E 100%);
    color: white;
    border: none;
    border-radius: 50px;
    cursor: pointer;
    transition: all 0.3s ease;
    box-shadow: 0 8px 25px rgba(139,69,19,0.4);
    touch-action: manipulation;
    -webkit-tap-highlight-color: transparent;
    user-select: none;
}

.back-btn:active {
    transform: scale(0.95);
}

.empty-hall-of-fame {
    text-align: center;
    padding: 40px;
    color: #999;
    font-size: 1.2em;
}

#gameScreen {
    display: flex;
    flex-direction: column;
    padding: 15px;
    gap: 10px;
    position: relative;
    z-index: 1;
}

#gameScreen.hidden {
    display: none;
}

#gameScreen > *:not(.restaurant-bg) {
    position: relative;
    z-index: 2;
}

.top-ui {
    display: flex;
    justify-content: space-between;
    padding: 0 30px;
    gap: 20px;
}

.score-display,
.level-display,
.combo-display {
    background: linear-gradient(135deg, #FFF8DC 0%, #FFE4B5 100%);
    padding: 10px 25px;
    border-radius: 15px;
    box-shadow: 0 5px 15px rgba(0,0,0,0.3);
    display: flex;
    gap: 10px;
    align-items: center;
    border: 3px solid #D2691E;
}

.combo-display {
    background: linear-gradient(135deg, #ff6b6b 0%, #ff5252 100%);
    border-color: #8B0000;
}

.combo-display .label,
.combo-display .value {
    color: white;
    text-shadow: 1px 1px 2px rgba(0,0,0,0.3);
}

.label {
    font-weight: 700;
    font-size: 1em;
}

.value {
    font-weight: 900;
    font-size: 1.5em;
    color: #FF6347;
}

.customer-area {
    display: flex;
    flex-direction: column;
    justify-content: flex-start;
    align-items: center;
    min-height: 200px;
    position: relative;
    padding-top: 0px;
    gap: 10px;
    margin-top: -20px;
}

.customer-area::before {
    display: none;
}

.customer {
    display: flex;
    flex-direction: column;
    align-items: center;
    gap: 10px;
    animation: customerEnter 0.5s ease;
    position: relative;
    transform: scale(0.85);
    margin-bottom: -10px;
}

@keyframes customerEnter {
    0% {
        transform: scale(0.7);
        opacity: 0;
    }
    100% {
        transform: scale(0.85);
        opacity: 1;
    }
}

@keyframes customerLeave {
    0% {
        transform: scale(0.85);
        opacity: 1;
    }
    100% {
        transform: scale(1.3);
        opacity: 0;
    }
}

@keyframes customerLeaveHappy {
    0% {
        transform: scale(0.85);
        opacity: 1;
    }
    100% {
        transform: scale(1.3);
        opacity: 0;
    }
}

@keyframes speechBubbleFadeOut {
    0% {
        opacity: 1;
    }
    100% {
        opacity: 0;
    }
}

@keyframes speechBubbleFadeIn {
    0% {
        opacity: 0;
    }
    100% {
        opacity: 1;
    }
}

.praise-bubble {
    position: absolute;
    top: 15%;
    left: -5%;
    background: white;
    padding: 15px 40px;
    border-radius: 20px;
    border: 4px solid #FF69B4;
    font-size: 1.5em;
    font-weight: 900;
    color: #FF1493;
    text-shadow: 1px 1px 2px rgba(0,0,0,0.1);
    box-shadow:
        0 5px 20px rgba(255,105,180,0.5),
        inset 0 2px 10px rgba(255,255,255,0.8);
    animation: bubbleFloat 2.5s ease-out forwards;
    pointer-events: none;
    z-index: 101;
    min-width: 200px;
    white-space: nowrap;
}

.praise-bubble::before {
    display: none;
}

.praise-bubble::after {
    content: '';
    display: none;
}

.praise-bubble .tail {
    position: absolute;
    bottom: -18px;
    left: 25px;
    width: 28px;
    height: 22px;
}

@keyframes bubbleFloat {
    0% {
        transform: scale(0);
        opacity: 0;
    }
    20% {
        transform: scale(1.1);
        opacity: 1;
    }
    80% {
        transform: scale(1);
        opacity: 1;
    }
    100% {
        transform: translateY(-30px) scale(0.9);
        opacity: 0;
    }
}

.tip-animation {
    position: absolute;
    top: 50%;
    left: 10%;
    transform: translate(0, -50%);
    font-size: 3em;
    font-weight: 900;
    color: #FFD700;
    text-shadow:
        2px 2px 0 #FF8C00,
        -2px -2px 0 #FF8C00,
        2px -2px 0 #FF8C00,
        -2px 2px 0 #FF8C00,
        4px 4px 10px rgba(0,0,0,0.5);
    animation: tipFloatLeft 1s ease-out forwards;
    pointer-events: none;
    z-index: 100;
    white-space: nowrap;
}

@keyframes tipFloat {
    0% {
        transform: translate(-50%, -50%) scale(0);
        opacity: 0;
    }
    50% {
        transform: translate(-50%, -80px) scale(1.2);
        opacity: 1;
    }
    100% {
        transform: translate(-50%, -120px) scale(1);
        opacity: 0;
    }
}

@keyframes tipFloatLeft {
    0% {
        transform: translate(0, -50%) scale(0);
        opacity: 0;
    }
    50% {
        transform: translate(0, -100px) scale(1.2);
        opacity: 1;
    }
    100% {
        transform: translate(0, -150px) scale(1);
        opacity: 0;
    }
}

.customer-image {
    width: 310px;
    height: 491px;
    transform: scale(0.7);
    object-fit: contain;
    filter: none;
    animation: none;
    transition: opacity 0.3s ease;
    margin-top: -30px;
    image-rendering: pixelated;
    image-rendering: -moz-crisp-edges;
    image-rendering: crisp-edges;
}


@keyframes bounce {
    0%, 100% {
        transform: translateY(0);
    }
    50% {
        transform: translateY(-10px);
    }
}

.speech-bubble {
    background: #E8E0D5;
    padding: 10px 18px;
    border-radius: 20px;
    box-shadow: 0 8px 20px rgba(0,0,0,0.2);
    position: relative;
    min-width: auto;
    max-width: 550px;
    border: none;
    margin: 15px auto 20px auto;
    width: fit-content;
}

.speech-bubble::before {
    content: '';
    position: absolute;
    top: -25px;
    left: 20px;
    width: 40px;
    height: 40px;
    background: #E8E0D5;
    border-radius: 50% 0 0 0;
    transform: rotate(-20deg);
}

.speech-bubble::after {
    content: '';
    display: none;
}

.order-text {
    font-weight: 800;
    color: #E74C3C;
    margin-bottom: 3px;
    font-size: 0.9em;
    text-align: center;
    text-shadow: none;
}

.order-burger {
    display: flex;
    justify-content: center;
    align-items: center;
    min-height: 40px;
    background: #E8E0D5;
    border-radius: 12px;
    padding: 3px 10px;
    box-shadow: none;
    border: none;
}

.order-layer {
    display: flex;
    flex-direction: column;
    align-items: center;
    position: relative;
}

.order-ingredient {
    font-size: 1.5em;
    margin: 0 3px;
    filter: drop-shadow(2px 2px 3px rgba(0,0,0,0.2));
}

.patience-bar {
    width: 100%;
    height: 18px;
    background: #ddd;
    border-radius: 10px;
    overflow: hidden;
    box-shadow: inset 0 2px 5px rgba(0,0,0,0.2);
    border: 3px solid #ccc;
    margin-top: 5px;
}

.patience-fill {
    height: 100%;
    background: linear-gradient(90deg, #51cf66 0%, #37b24d 100%);
    transition: width 0.3s linear, background 0.3s ease;
    border-radius: 10px;
    width: 100%;
}

.patience-fill.warning {
    background: linear-gradient(90deg, #ffa500 0%, #ff8c00 100%);
}

.patience-fill.danger {
    background: linear-gradient(90deg, #ff6b6b 0%, #ff0000 100%);
    animation: shake 0.5s infinite;
}

@keyframes shake {
    0%, 100% { transform: translateX(0); }
    25% { transform: translateX(-2px); }
    75% { transform: translateX(2px); }
}

.work-area {
    display: flex;
    justify-content: center;
    flex: 0;
    min-height: auto;
    margin-bottom: 15px;
}

.game-controls {
    display: none;
}

.game-score {
    display: flex;
    align-items: center;
    justify-content: center;
    gap: 5px;
    padding: 18px 20px;
    background: transparent;
    border: none;
    font-weight: 900;
    color: #FFF;
    font-size: 1.2em;
    text-shadow: 2px 2px 0 #000;
    text-transform: uppercase;
    letter-spacing: 2px;
}

.score-label {
    color: #FFF;
}

.score-value {
    color: #FFD700;
}

.game-btn {
    display: flex;
    flex-direction: column;
    align-items: center;
    justify-content: center;
    gap: 5px;
    background: linear-gradient(135deg, #A67C52 0%, #8B6F47 100%);
    border: 4px solid #000;
    border-radius: 10px;
    padding: 10px;
    cursor: pointer;
    transition: all 0.1s ease;
    box-shadow: 0 5px 0 #000, inset 0 2px 6px rgba(255,255,255,0.2);
    font-weight: 900;
    color: #FFF;
    font-size: 0.65em;
    touch-action: manipulation;
    -webkit-tap-highlight-color: transparent;
    user-select: none;
    text-shadow: 2px 2px 0 #000;
    text-transform: uppercase;
    letter-spacing: 0.5px;
    width: 100px;
    height: 210px;
    white-space: normal;
    text-align: center;
    line-height: 1.2;
}

.game-btn:active {
    transform: translateY(3px);
    box-shadow: 0 2px 0 #000, inset 0 2px 6px rgba(255,255,255,0.2);
}

.game-btn .btn-icon {
    font-size: 1.3em;
}

.undo-btn {
    background: linear-gradient(135deg, #E74C3C 0%, #C0392B 100%);
    box-shadow: 0 5px 0 #000, inset 0 2px 6px rgba(255,255,255,0.2);
}

.submit-btn {
    background: linear-gradient(135deg, #A67C52 0%, #8B6F47 100%);
    box-shadow: 0 5px 0 #000, inset 0 2px 6px rgba(255,255,255,0.2);
}

.counter {
    background:
        repeating-linear-gradient(
            90deg,
            #B8956B 0px,
            #B8956B 40px,
            #A67C52 40px,
            #A67C52 80px,
            #C4A574 80px,
            #C4A574 120px
        ),
        linear-gradient(180deg, #C4A574 0%, #A67C52 50%, #8B6F47 100%);
    width: 450px;
    height: 120px;
    border-radius: 20px;
    box-shadow:
        0 6px 0 #5D4A37,
        0 6px 20px rgba(0,0,0,0.6),
        inset 0 3px 12px rgba(255,255,255,0.2),
        inset 0 -3px 12px rgba(0,0,0,0.3);
    display: flex;
    justify-content: center;
    align-items: center;
    padding: 15px;
    position: relative;
    border: 4px solid #3E2A1A;
}

.counter::before {
    content: '';
    position: absolute;
    top: 15px;
    left: 15px;
    right: 15px;
    height: 12px;
    background: linear-gradient(90deg,
        #CD853F 0%,
        #D2691E 20%,
        #CD853F 40%,
        #D2691E 60%,
        #CD853F 80%,
        #D2691E 100%
    );
    border-radius: 8px;
    box-shadow:
        0 3px 8px rgba(0,0,0,0.4),
        inset 0 2px 4px rgba(255,255,255,0.2);
    border: 2px solid #8B4513;
}

.counter::after {
    display: none;
}

.work-area::before {
    display: none;
}

.building-plate {
    background: transparent;
    width: 100%;
    height: auto;
    border-radius: 0;
    box-shadow: none;
    display: flex;
    justify-content: center;
    align-items: flex-end;
    padding-bottom: 0px;
    border: none;
    position: relative;
}

.building-plate::before {
    content: '';
    display: none;
}

.burger-building {
    display: flex;
    flex-direction: column-reverse;
    align-items: center;
    gap: 0;
    position: relative;
    width: 100%;
    height: 100%;
}

.building-ingredient {
    font-size: 2.5em;
    margin: -10px 0;
    filter: drop-shadow(2px 2px 3px rgba(0,0,0,0.2));
    position: relative;
}

.building-ingredient.new-ingredient {
    animation: ingredientDrop 0.4s ease;
}

@keyframes ingredientDrop {
    from {
        transform: translateY(-50px);
        opacity: 0;
    }
    to {
        transform: translateY(0);
        opacity: 1;
    }
}

@keyframes ingredientShuffle {
    0%, 100% {
        transform: translateY(0);
        opacity: 1;
    }
    25% {
        transform: translateY(-15px) rotate(-5deg);
        opacity: 0.7;
    }
    50% {
        transform: translateY(-20px) rotate(5deg);
        opacity: 0.5;
    }
    75% {
        transform: translateY(-10px) rotate(-3deg);
        opacity: 0.7;
    }
}

.ingredients-area {
    position: relative;
    display: flex;
    justify-content: center;
    align-items: center;
    gap: 10px;
    padding: 0 20px 15px 20px;
    margin-top: 0;
}

.ingredients-wrapper {
    display: flex;
    gap: 15px;
    align-items: center;
    justify-content: center;
}

.ingredients-container {
    display: grid;
    grid-template-columns: repeat(5, 1fr);
    gap: 10px;
    background: transparent;
    padding: 0;
    border-radius: 0;
    box-shadow: none;
    border: none;
    max-width: 550px;
    width: 550px;
    flex-shrink: 0;
}

.ingredients-container.with-sides {
    grid-template-columns: repeat(6, 1fr);
    max-width: 650px;
    width: 650px;
}

.ingredient-slot {
    width: 100%;
    aspect-ratio: 1;
    background: linear-gradient(135deg, #A67C52 0%, #8B6F47 100%);
    border: 3px solid #000;
    border-radius: 10px;
    display: flex;
    flex-direction: column;
    justify-content: center;
    align-items: center;
    cursor: pointer;
    transition: all 0.1s ease;
    position: relative;
    touch-action: manipulation;
    -webkit-tap-highlight-color: transparent;
    box-shadow: 0 4px 0 #000, inset 0 2px 6px rgba(255,255,255,0.2);
    gap: 5px;
}

.ingredient-slot[data-ingredient="bun"] {
    background: linear-gradient(135deg, #E8C89A 0%, #D4A574 100%);
}

.ingredient-slot[data-ingredient="patty"] {
    background: linear-gradient(135deg, #8B4513 0%, #6B3410 100%);
}

.ingredient-slot[data-ingredient="cheese"] {
    background: linear-gradient(135deg, #FFD93D 0%, #FFA500 100%);
}

.ingredient-slot[data-ingredient="lettuce"] {
    background: linear-gradient(135deg, #90EE90 0%, #32CD32 100%);
}

.ingredient-slot[data-ingredient="tomato"] {
    background: linear-gradient(135deg, #FF6B6B 0%, #EE5A52 100%);
}

.ingredient-slot[data-ingredient="onion"] {
    background: linear-gradient(135deg, #E4A0D4 0%, #D77FBC 100%);
}

.ingredient-slot[data-ingredient="pickle"] {
    background: linear-gradient(135deg, #7CB342 0%, #558B2F 100%);
}

.ingredient-slot[data-ingredient="bacon"] {
    background: linear-gradient(135deg, #CD7F32 0%, #A0522D 100%);
}

.ingredient-slot[data-ingredient="egg"] {
    background: linear-gradient(135deg, #FFE082 0%, #FFD54F 100%);
}

@media (hover: hover) {
    .start-btn:hover {
        transform: translateY(-5px) scale(1.05);
        box-shadow: 0 15px 40px rgba(255,99,71,0.6);
    }

    .restart-btn:hover {
        transform: translateY(-5px) scale(1.05);
        box-shadow: 0 15px 40px rgba(81,207,102,0.6);
    }
}

.ingredient-slot:active {
    transform: translateY(-2px);
    filter: brightness(1.1);
}

.ingredient-slot.selected {
    background: linear-gradient(135deg, #FF6347 0%, #FF4500 100%);
    border-color: #FFD700;
    transform: translateY(-2px);
    filter: brightness(1.1);
    border-width: 6px;
    transform: translateY(-8px) scale(1.1);
    box-shadow: 0 8px 0 #FFD700, 0 0 20px rgba(255,215,0,0.8), inset 0 3px 8px rgba(255,255,255,0.6);
    animation: selectedPulse 1s ease-in-out infinite;
}

@keyframes selectedPulse {
    0%, 100% {
        box-shadow: 0 8px 0 #FFD700, 0 0 20px rgba(255,215,0,0.8), inset 0 3px 8px rgba(255,255,255,0.6);
    }
    50% {
        box-shadow: 0 8px 0 #FFD700, 0 0 30px rgba(255,215,0,1), inset 0 3px 8px rgba(255,255,255,0.6);
    }
}

.ingredient-icon {
    font-size: 2.5em;
    filter: drop-shadow(2px 2px 3px rgba(0,0,0,0.3));
}

.ingredient-label {
    display: none;
}

.ingredient-slot.side-slot {
    background: linear-gradient(135deg, #E8F5E9 0%, #C8E6C9 100%);
    border-color: #4CAF50;
}

.ingredient-slot.side-slot:hover {
    border-color: #2E7D32;
}

.ingredient-slot.side-slot.selected {
    background: linear-gradient(135deg, #A5D6A7 0%, #81C784 100%);
    border-color: #2E7D32;
}

.building-side {
    font-size: 2.5em !important;
}

.order-side {
    transform: scale(1.1);
}

.key-hints {
    display: flex;
    justify-content: center;
    gap: 20px;
}

.hint {
    background: rgba(0,0,0,0.6);
    color: white;
    padding: 8px 15px;
    border-radius: 10px;
    font-size: 0.9em;
    font-weight: 700;
}

.mobile-controls {
    display: none;
    position: fixed;
    bottom: 20px;
    left: 50%;
    transform: translateX(-50%);
    gap: 15px;
    z-index: 1000;
    background: rgba(0,0,0,0.7);
    padding: 15px 20px;
    border-radius: 25px;
    box-shadow: 0 10px 30px rgba(0,0,0,0.5);
}

.mobile-btn {
    display: flex;
    flex-direction: column;
    align-items: center;
    justify-content: center;
    background: linear-gradient(135deg, #FF8C00 0%, #FF6347 100%);
    border: none;
    border-radius: 15px;
    padding: 15px 20px;
    cursor: pointer;
    transition: all 0.3s ease;
    box-shadow: 0 5px 15px rgba(255,99,71,0.4);
    min-width: 80px;
    touch-action: manipulation;
    -webkit-tap-highlight-color: transparent;
    user-select: none;
}

.mobile-btn:active {
    transform: scale(0.95);
    box-shadow: 0 2px 8px rgba(255,99,71,0.6);
}

.mobile-btn .btn-icon {
    font-size: 1.5em;
    margin-bottom: 5px;
}

.mobile-btn .btn-label {
    font-size: 0.8em;
    font-weight: 700;
    color: white;
}

.undo-mobile-btn {
    background: linear-gradient(135deg, #868e96 0%, #495057 100%);
    box-shadow: 0 5px 15px rgba(73,80,87,0.4);
}

.add-mobile-btn {
    background: linear-gradient(135deg, #51cf66 0%, #37b24d 100%);
    box-shadow: 0 5px 15px rgba(55,178,77,0.4);
}

.submit-mobile-btn {
    background: linear-gradient(135deg, #FF6347 0%, #DC143C 100%);
    box-shadow: 0 5px 15px rgba(220,20,60,0.4);
    transform: scale(1.15);
    animation: pulse 2s ease-in-out infinite;
}

@keyframes pulse {
    0%, 100% {
        box-shadow: 0 5px 15px rgba(220,20,60,0.4);
    }
    50% {
        box-shadow: 0 5px 25px rgba(220,20,60,0.7);
    }
}

.submit-btn-fixed {
    display: flex;
    flex-direction: column;
    align-items: center;
    justify-content: center;
    background: linear-gradient(135deg, #FF6347 0%, #DC143C 100%);
    border: none;
    border-radius: 20px;
    padding: 20px;
    cursor: pointer;
    transition: all 0.3s ease;
    box-shadow: 0 8px 20px rgba(220,20,60,0.5);
    min-width: 100px;
    min-height: 100px;
    touch-action: manipulation;
    -webkit-tap-highlight-color: transparent;
    user-select: none;
    animation: pulse 2s ease-in-out infinite;
    flex-shrink: 0;
}

.submit-btn-fixed:active {
    transform: scale(0.95);
}

.submit-btn-fixed .btn-icon {
    font-size: 2.5em;
    margin-bottom: 5px;
}

.submit-btn-fixed .btn-label {
    font-size: 1em;
    font-weight: 700;
    color: white;
}

.clear-content {
    text-align: center;
    background: linear-gradient(135deg, #FFE4B5 0%, #FFD700 50%, #FFA500 100%);
    padding: 60px;
    border-radius: 30px;
    box-shadow:
        0 20px 60px rgba(0,0,0,0.5),
        0 0 50px rgba(255,215,0,0.6);
    border: 8px solid #FFD700;
    position: relative;
    animation: clearPulse 2s ease-in-out infinite;
}

@keyframes clearPulse {
    0%, 100% {
        box-shadow:
            0 20px 60px rgba(0,0,0,0.5),
            0 0 50px rgba(255,215,0,0.6);
    }
    50% {
        box-shadow:
            0 20px 60px rgba(0,0,0,0.5),
            0 0 80px rgba(255,215,0,1);
    }
}

.clear-content::before {
    content: 'üëë';
    position: absolute;
    top: -50px;
    left: 50%;
    transform: translateX(-50%);
    font-size: 5em;
    animation: crownBounce 1s ease-in-out infinite;
}

@keyframes crownBounce {
    0%, 100% {
        transform: translateX(-50%) translateY(0) rotate(0deg);
    }
    50% {
        transform: translateX(-50%) translateY(-10px) rotate(10deg);
    }
}

.clear-title {
    font-size: 4em;
    font-weight: 900;
    background: linear-gradient(135deg, #FF6347 0%, #FFD700 50%, #FF6347 100%);
    -webkit-background-clip: text;
    -webkit-text-fill-color: transparent;
    background-clip: text;
    margin-bottom: 20px;
    text-shadow: 2px 2px 10px rgba(255,215,0,0.5);
    animation: titleShine 2s linear infinite;
}

@keyframes titleShine {
    0% {
        background-position: 0% 50%;
    }
    100% {
        background-position: 200% 50%;
    }
}

.clear-message {
    font-size: 1.5em;
    font-weight: 700;
    color: #8B4513;
    margin-bottom: 30px;
    text-shadow: 1px 1px 2px rgba(255,255,255,0.8);
}

.gameover-content {
    text-align: center;
    background: linear-gradient(135deg, #FFE4E1 0%, #FFC0CB 100%);
    padding: 60px;
    border-radius: 30px;
    box-shadow: 0 20px 60px rgba(0,0,0,0.5);
    border: 8px solid #D2691E;
    position: relative;
}

.gameover-content::before {
    content: 'üò¢';
    position: absolute;
    top: -40px;
    left: 50%;
    transform: translateX(-50%);
    font-size: 4em;
}

.gameover-title {
    font-size: 4em;
    color: #ff6b6b;
    margin-bottom: 40px;
    font-weight: 900;
    text-shadow: 3px 3px 0px #ff5252;
}

.final-stats {
    display: grid;
    grid-template-columns: repeat(2, 1fr);
    gap: 30px;
    margin-bottom: 40px;
}

.stat {
    background: #f8f9fa;
    padding: 20px;
    border-radius: 15px;
}

.stat-label {
    font-size: 1em;
    color: #666;
    font-weight: 600;
    margin-bottom: 10px;
}

.stat-value {
    font-size: 2.5em;
    font-weight: 900;
    color: #FF6347;
}

.restart-btn {
    padding: 20px 60px;
    font-size: 1.5em;
    font-weight: 900;
    background: linear-gradient(135deg, #51cf66 0%, #37b24d 100%);
    color: white;
    border: none;
    border-radius: 50px;
    cursor: pointer;
    transition: all 0.3s ease;
    box-shadow: 0 10px 30px rgba(81,207,102,0.4);
    touch-action: manipulation;
    -webkit-tap-highlight-color: transparent;
    user-select: none;
}

.restart-btn:active {
    transform: scale(0.95);
}

@media (max-width: 768px) {
    body {
        overflow-y: auto;
        height: auto;
        min-height: 100vh;
    }

    .game-container {
        overflow-y: auto;
        height: auto;
        min-height: 100vh;
        padding-bottom: 120px;
    }

    .game-logo {
        font-size: 2.5em;
    }

    .menu-board {
        width: 120px;
        height: 180px;
        top: 10px;
        right: 10px;
    }

    .menu-board::before {
        font-size: 1em;
        top: 10px;
    }

    .menu-board::after {
        font-size: 0.7em;
        top: 45px;
        line-height: 1.5;
    }

    .clock {
        width: 60px;
        height: 60px;
        top: 60px;
        right: 150px;
    }

    .clock::before {
        font-size: 0.7em;
    }

    .clock::after {
        height: 15px;
    }

    .customer-area {
        margin-bottom: 20px;
    }

    .customer {
        transform: scale(0.75);
    }

    .customer-image {
        height: 200px;
    }

    .speech-bubble {
        min-width: 250px;
        padding: 12px 15px;
    }

    .order-ingredient {
        font-size: 1.8em;
    }

    .counter {
        width: 90%;
        height: 200px;
    }

    .building-plate {
        width: 100px;
        height: 100px;
    }

    .building-ingredient {
        font-size: 1.8em;
    }

    .ingredients-container {
        width: 100%;
        max-width: 100%;
        gap: 6px;
        padding: 10px;
        overflow-x: hidden;
        grid-template-columns: repeat(5, 1fr);
    }

    .ingredients-container.with-sides {
        width: 100%;
        max-width: 100%;
        grid-template-columns: repeat(6, 1fr);
    }

    .ingredient-slot {
        width: 100%;
        height: auto;
        aspect-ratio: 1;
        flex-shrink: 1;
    }

    .ingredient-icon {
        font-size: 1.8em;
    }

    .ingredient-label {
        font-size: 0.55em;
    }

    .key-hints {
        display: none;
    }

    .mobile-controls {
        display: flex;
    }

    .top-ui {
        gap: 10px;
        margin-bottom: 15px;
    }

    .score-display,
    .level-display,
    .combo-display {
        padding: 8px 15px;
    }

    .label {
        font-size: 0.8em;
    }

    .value {
        font-size: 1.2em;
    }

    .final-stats {
        grid-template-columns: 1fr;
        gap: 20px;
    }

    .stat-value {
        font-size: 2em;
    }

    .restart-btn {
        padding: 15px 40px;
        font-size: 1.2em;
    }

    .start-content {
        padding: 20px;
    }

    .controls-info {
        display: none;
    }

    .nickname-input {
        width: 90%;
        font-size: 1em;
        padding: 12px 20px;
    }

    .start-btn {
        padding: 15px 40px;
        font-size: 1.2em;
    }

    .hall-of-fame-btn {
        padding: 12px 30px;
        font-size: 1em;
    }

    .hall-of-fame-content {
        padding: 20px;
        width: 95%;
    }

    .hall-of-fame-title {
        font-size: 2em;
    }

    .hall-of-fame-item {
        padding: 15px;
        gap: 15px;
    }

    .hall-of-fame-rank {
        font-size: 1.5em;
        min-width: 40px;
    }

    .hall-of-fame-name {
        font-size: 1.2em;
    }

    .hall-of-fame-stats {
        font-size: 0.8em;
        gap: 10px;
    }

    .back-btn {
        padding: 12px 30px;
        font-size: 1em;
    }
}

@media (max-width: 480px) {
    .game-logo {
        font-size: 1.8em;
    }

    .menu-board,
    .clock {
        display: none;
    }

    .customer-image {
        height: 160px;
    }

    .speech-bubble {
        min-width: 200px;
        padding: 10px;
    }

    .order-text {
        font-size: 1em;
    }

    .order-ingredient {
        font-size: 1.5em;
    }

    .counter {
        height: 180px;
    }

    .building-plate {
        width: 90px;
        height: 90px;
    }

    .building-ingredient {
        font-size: 1.5em;
    }

    .ingredients-container {
        gap: 4px;
        padding: 8px;
    }

    .ingredient-slot {
        width: 100%;
        height: auto;
        aspect-ratio: 1;
    }

    .ingredient-icon {
        font-size: 1.4em;
    }

    .ingredient-label {
        font-size: 0.45em;
    }

    .mobile-controls {
        gap: 10px;
        padding: 12px 15px;
        bottom: 10px;
    }

    .mobile-btn {
        padding: 12px 15px;
        min-width: 70px;
    }

    .mobile-btn .btn-icon {
        font-size: 1.3em;
    }

    .mobile-btn .btn-label {
        font-size: 0.75em;
    }

    .top-ui {
        flex-wrap: wrap;
        gap: 8px;
    }

    .score-display,
    .level-display,
    .combo-display {
        padding: 6px 12px;
        flex: 1;
        min-width: 80px;
    }

    .label {
        font-size: 0.7em;
    }

    .value {
        font-size: 1em;
    }

    .clear-title,
    .gameover-title {
        font-size: 2em;
    }

    .stat-value {
        font-size: 1.5em;
    }

    .restart-btn {
        padding: 12px 30px;
        font-size: 1em;
    }

    .nickname-input {
        font-size: 0.9em;
        padding: 10px 15px;
    }

    .start-btn {
        padding: 12px 30px;
        font-size: 1em;
    }

    .hall-of-fame-btn {
        padding: 10px 25px;
        font-size: 0.9em;
    }

    .hall-of-fame-content {
        padding: 15px;
    }

    .hall-of-fame-title {
        font-size: 1.5em;
        margin-bottom: 20px;
    }

    .hall-of-fame-item {
        padding: 12px;
        gap: 10px;
        flex-direction: column;
        align-items: flex-start;
    }

    .hall-of-fame-rank {
        font-size: 1.8em;
        min-width: auto;
    }

    .hall-of-fame-name {
        font-size: 1.1em;
    }

    .hall-of-fame-stats {
        font-size: 0.75em;
        gap: 8px;
    }

    .back-btn {
        padding: 10px 25px;
        font-size: 0.9em;
    }

    .empty-hall-of-fame {
        font-size: 1em;
        padding: 30px;
    }
}

@media (max-height: 600px) and (orientation: landscape) {
    .game-container {
        padding-bottom: 80px;
    }

    .customer {
        transform: scale(0.6);
        margin-bottom: -20px;
    }

    .counter {
        height: 150px;
    }

    .building-plate {
        width: 80px;
        height: 80px;
    }

    .mobile-controls {
        padding: 8px 12px;
        gap: 8px;
    }

    .mobile-btn {
        padding: 10px 12px;
        min-width: 60px;
    }
}
    </style>
</head>
<body>
    <div class="game-container">
        <div id="startScreen" class="screen">
            <div class="start-content">
                <h1 class="game-logo">BURGER SHOP</h1>
                <p class="game-desc">ÏÜêÎãòÏùò Ï£ºÎ¨∏ÏùÑ Î∞õÍ≥† ÌñÑÎ≤ÑÍ±∞Î•º ÎßåÎìúÏÑ∏Ïöî!</p>
                <div class="nickname-input-container">
                    <input type="text" id="nicknameInput" class="nickname-input" placeholder="ÎãâÎÑ§ÏûÑ (ÏÑ†ÌÉùÏÇ¨Ìï≠)" maxlength="10">
                </div>
                <button class="start-btn" onclick="startGame()">START GAME</button>
                <button class="hall-of-fame-btn" onclick="showHallOfFame()">üèÜ Î™ÖÏòàÏùò Ï†ÑÎãπ</button>
            </div>
        </div>

        <div id="gameScreen" class="screen hidden">
            <div class="restaurant-bg">
                <div class="lamp"></div>
                <div class="shop-sign"></div>
                <div class="menu-board"></div>
                <div class="clock"></div>
            </div>

            <div class="top-ui">
                <div class="score-display">
                    <span class="label">üí∞ ÏàòÏùµ</span>
                    <span class="value" id="scoreValue">0Ïõê</span>
                </div>
                <div class="level-display">
                    <span class="label">üìä Î†àÎ≤®</span>
                    <span class="value" id="levelValue">1</span>
                </div>
                <div class="combo-display">
                    <span class="label">üî• ÏΩ§Î≥¥</span>
                    <span class="value" id="comboValue">0</span>
                </div>
            </div>

            <div class="customer-area">
                <div class="customer" id="customer">
                    <img src="customer-waiting.png" alt="Customer" class="customer-image" id="customerImage">
                </div>
            </div>

            <div class="speech-bubble">
                <div class="order-text">Ï£ºÎ¨∏Ìï¥Ï£ºÏÑ∏Ïöî!</div>
                <div class="order-burger" id="orderBurger"></div>
                <div class="patience-bar">
                    <div class="patience-fill" id="patienceFill"></div>
                </div>
            </div>

            <div class="work-area">
                <div class="counter">
                    <div class="building-plate">
                        <div class="burger-building" id="burgerBuilding"></div>
                    </div>
                </div>
            </div>

            <div class="ingredients-area">
                <button class="game-btn undo-btn" onclick="undoIngredient()">
                    <span class="btn-label">Î≤ÑÎ¶¨Í∏∞</span>
                </button>
                <div class="ingredients-container" id="ingredientsContainer">
                </div>
                <button class="game-btn submit-btn" onclick="submitBurger()">
                    <span class="btn-label">ÏôÑÎ£å</span>
                </button>
                <div class="selection-indicator" id="selectionIndicator"></div>
            </div>

            <div class="key-hints">
                <span class="hint">‚Üê ‚Üí ‚Üë ‚Üì Ïù¥Îèô</span>
                <span class="hint">SPACE Ï∂îÍ∞Ä</span>
                <span class="hint">BACKSPACE ÏÇ≠Ï†ú</span>
                <span class="hint">ENTER Ìè¨Ïû•</span>
            </div>

            <div class="mobile-controls">
                <button class="mobile-btn undo-mobile-btn" onclick="undoIngredient()">
                    <span class="btn-icon">‚Ü©Ô∏è</span>
                    <span class="btn-label">ÏÇ≠Ï†ú</span>
                </button>
                <button class="mobile-btn add-mobile-btn" onclick="addSelectedIngredient()">
                    <span class="btn-icon">‚ûï</span>
                    <span class="btn-label">Ï∂îÍ∞Ä</span>
                </button>
                <button class="mobile-btn submit-mobile-btn" onclick="submitBurger()">
                    <span class="btn-icon">üì¶</span>
                    <span class="btn-label">Ìè¨Ïû•</span>
                </button>
            </div>
        </div>

        <div id="gameClearScreen" class="screen hidden">
            <div class="clear-content">
                <h1 class="clear-title">üéâ CLEAR! üéâ</h1>
                <div class="clear-message">Î™©Ìëú Îã¨ÏÑ±! 100ÏõêÏùÑ Î≤åÏóàÏäµÎãàÎã§!</div>
                <div class="final-stats">
                    <div class="stat">
                        <div class="stat-label">Ï¥ù ÏàòÏùµ</div>
                        <div class="stat-value" id="clearScore">100Ïõê</div>
                    </div>
                    <div class="stat">
                        <div class="stat-label">Î†àÎ≤®</div>
                        <div class="stat-value" id="clearLevel">1</div>
                    </div>
                    <div class="stat">
                        <div class="stat-label">ÏôÑÏÑ±Ìïú ÌñÑÎ≤ÑÍ±∞</div>
                        <div class="stat-value" id="clearBurgers">0</div>
                    </div>
                </div>
                <button class="restart-btn" onclick="restartGame()">üîÑ Îã§Ïãú ÌïòÍ∏∞</button>
                <button class="hall-of-fame-btn" onclick="showHallOfFame()">üèÜ Î™ÖÏòàÏùò Ï†ÑÎãπ</button>
            </div>
        </div>

        <div id="gameOverScreen" class="screen hidden">
            <div class="gameover-content">
                <h1 class="gameover-title">GAME OVER</h1>
                <div class="final-stats">
                    <div class="stat">
                        <div class="stat-label">Ï¥ù ÏàòÏùµ</div>
                        <div class="stat-value" id="finalScore">0Ïõê</div>
                    </div>
                    <div class="stat">
                        <div class="stat-label">Î†àÎ≤®</div>
                        <div class="stat-value" id="finalLevel">1</div>
                    </div>
                    <div class="stat">
                        <div class="stat-label">ÏôÑÏÑ±Ìïú ÌñÑÎ≤ÑÍ±∞</div>
                        <div class="stat-value" id="totalBurgers">0</div>
                    </div>
                </div>
                <button class="restart-btn" onclick="restartGame()">üîÑ Îã§Ïãú ÌïòÍ∏∞</button>
                <button class="hall-of-fame-btn" onclick="showHallOfFame()">üèÜ Î™ÖÏòàÏùò Ï†ÑÎãπ</button>
            </div>
        </div>

        <div id="hallOfFameScreen" class="screen hidden">
            <div class="hall-of-fame-content">
                <h1 class="hall-of-fame-title">üèÜ Î™ÖÏòàÏùò Ï†ÑÎãπ üèÜ</h1>
                <div class="hall-of-fame-list" id="hallOfFameList">
                    <!-- Î™ÖÏòàÏùò Ï†ÑÎãπ Ìï≠Î™©Îì§Ïù¥ Ïó¨Í∏∞Ïóê ÎèôÏ†ÅÏúºÎ°ú Ï∂îÍ∞ÄÎê® -->
                </div>
                <button class="back-btn" onclick="backToStart()">‚Üê Ï≤òÏùåÏúºÎ°ú</button>
            </div>
        </div>
    </div>

    <!-- Firebase SDK -->
    <script type="module">
// Firebase ÏÑ§Ï†ï
import { initializeApp } from 'https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js';
import { getDatabase, ref, push, onValue, query, orderByChild, limitToLast, remove } from 'https://www.gstatic.com/firebasejs/10.7.1/firebase-database.js';

const firebaseConfig = {
  apiKey: "AIzaSyD2059HJsHxTPElCDG_IbumjIJS5fWb33g",
  authDomain: "burger-game-ea653.firebaseapp.com",
  databaseURL: "https://burger-game-ea653-default-rtdb.asia-southeast1.firebasedatabase.app",
  projectId: "burger-game-ea653",
  storageBucket: "burger-game-ea653.firebasestorage.app",
  messagingSenderId: "820969841043",
  appId: "1:820969841043:web:1fc1e49d266db6b1fe4866",
  measurementId: "G-KPR3E5QPNT"
};

// Firebase Ï¥àÍ∏∞Ìôî
const app = initializeApp(firebaseConfig);
const database = getDatabase(app);

// Ï†ÑÏó≠ÏúºÎ°ú export
window.firebaseDB = database;
window.firebaseRef = ref;
window.firebasePush = push;
window.firebaseOnValue = onValue;
window.firebaseQuery = query;
window.firebaseOrderByChild = orderByChild;
window.firebaseLimitToLast = limitToLast;
window.firebaseRemove = remove;

console.log('üî• Firebase Ïó∞Í≤∞ ÏôÑÎ£å!');

// "ÏïåÎ∞îÏÉù" ÎãâÎÑ§ÏûÑ Ìï≠Î™©Îì§ÏùÑ ÏÇ≠Ï†úÌïòÎäî Ìï®Ïàò
async function deleteAlbasaengRecords() {
    const hallOfFameRef = window.firebaseRef(window.firebaseDB, 'hallOfFame');

    window.firebaseOnValue(hallOfFameRef, (snapshot) => {
        let deleteCount = 0;
        snapshot.forEach((childSnapshot) => {
            const data = childSnapshot.val();
            if (data.nickname === 'ÏïåÎ∞îÏÉù') {
                const itemRef = window.firebaseRef(window.firebaseDB, `hallOfFame/${childSnapshot.key}`);
                window.firebaseRemove(itemRef);
                deleteCount++;
                console.log('üóëÔ∏è ÏÇ≠Ï†ú:', childSnapshot.key, data);
            }
        });
        console.log(`‚úÖ Ï¥ù ${deleteCount}Í∞úÏùò "ÏïåÎ∞îÏÉù" Í∏∞Î°ù ÏÇ≠Ï†ú ÏôÑÎ£å`);
    }, { onlyOnce: true });
}

// Ìï®Ïàò Ïã§Ìñâ
deleteAlbasaengRecords();
    </script>

    <script>
let gameState = {
    nickname: '',
    score: 0,
    level: 1,
    combo: 0,
    maxCombo: 0,
    totalBurgers: 0,
    mistakes: 0,
    usedRecipes: [],
    currentOrder: [],
    currentSides: [],
    playerBurger: [],
    playerSides: [],
    selectedIngredientIndex: 0,
    isPlaying: false,
    isSubmitting: false,
    patienceTimer: null,
    patienceValue: 100,
    patienceDecreaseRate: 1.2,
    hasShownWarningMessage: false,
    hasShownUrgentMessage: false,
    shouldShowRushMessages: false,
    usedPraiseMessages: []
};

const ingredients = [
    { id: 'bun', name: 'BREAD', icon: 'üü§', visual: 'üçû' },
    { id: 'patty', name: 'PATTY', icon: 'üü´', visual: 'ü•©' },
    { id: 'cheese', name: 'CHEESE', icon: 'üü®', visual: 'üßÄ' },
    { id: 'lettuce', name: 'LETTUCE', icon: 'üü©', visual: 'ü•¨' },
    { id: 'tomato', name: 'TOMATO', icon: 'üü•', visual: 'üçÖ' },
    { id: 'onion', name: 'ONION', icon: '‚¨ú', visual: 'üßÖ' },
    { id: 'pickle', name: 'PICKLE', icon: 'üü¢', visual: 'ü•í' },
    { id: 'bacon', name: 'BACON', icon: 'üüß', visual: 'ü•ì' },
    { id: 'egg', name: 'EGG', icon: 'üü°', visual: 'üç≥' },
    { id: 'pepper', name: 'PEPPER', icon: 'üü¢', visual: 'ü´ë' }
];

const sideItems = [
    { id: 'cola', name: 'ÏΩúÎùº', visual: 'ü•§' },
    { id: 'fries', name: 'Í∞êÏûêÌäÄÍπÄ', visual: 'üçü' }
];

const recipes = [
    ['bun', 'lettuce', 'patty', 'cheese', 'tomato', 'bun'],
    ['bun', 'onion', 'lettuce', 'patty', 'cheese', 'tomato', 'bun'],
    ['bun', 'pickle', 'cheese', 'patty', 'lettuce', 'tomato', 'bun'],
    ['bun', 'lettuce', 'bacon', 'cheese', 'patty', 'tomato', 'bun'],
    ['bun', 'patty', 'bacon', 'cheese', 'lettuce', 'bun'],
    ['bun', 'pickle', 'patty', 'egg', 'cheese', 'bun'],
    ['bun', 'lettuce', 'tomato', 'onion', 'pickle', 'cheese', 'bun'],
    ['bun', 'bacon', 'bacon', 'cheese', 'egg', 'lettuce', 'bun'],
    ['bun', 'onion', 'patty', 'tomato', 'lettuce', 'pickle', 'bun'],
    ['bun', 'cheese', 'bacon', 'patty', 'egg', 'cheese', 'bun'],
    ['bun', 'pickle', 'onion', 'patty', 'cheese', 'bacon', 'lettuce', 'tomato', 'bun'],
    ['bun', 'patty', 'cheese', 'patty', 'bacon', 'egg', 'lettuce', 'onion', 'bun'],
    ['bun', 'lettuce', 'pickle', 'patty', 'cheese', 'bacon', 'tomato', 'egg', 'bun'],
    ['bun', 'onion', 'tomato', 'patty', 'bacon', 'cheese', 'lettuce', 'pickle', 'egg', 'bun'],
    ['bun', 'bacon', 'patty', 'egg', 'cheese', 'onion', 'lettuce', 'tomato', 'pickle', 'bun'],
    ['bun', 'patty', 'cheese', 'patty', 'bacon', 'cheese', 'egg', 'lettuce', 'tomato', 'onion', 'bun'],
    ['bun', 'pickle', 'pickle', 'onion', 'lettuce', 'patty', 'cheese', 'bacon', 'tomato', 'egg', 'patty', 'bun'],
    ['bun', 'cheese', 'bacon', 'patty', 'egg', 'cheese', 'patty', 'lettuce', 'onion', 'tomato', 'bacon', 'bun'],
    ['bun', 'bacon', 'egg', 'patty', 'cheese', 'pickle', 'onion', 'lettuce', 'tomato', 'bacon', 'cheese', 'patty', 'bun'],
    ['bun', 'lettuce', 'onion', 'pickle', 'patty', 'cheese', 'bacon', 'egg', 'tomato', 'cheese', 'patty', 'lettuce', 'bun'],
    ['bun', 'pickle', 'patty', 'cheese', 'bacon', 'egg', 'onion', 'patty', 'cheese', 'lettuce', 'tomato', 'bacon', 'pickle', 'bun'],
    ['bun', 'onion', 'bacon', 'patty', 'cheese', 'egg', 'lettuce', 'pickle', 'tomato', 'patty', 'cheese', 'bacon', 'onion', 'lettuce', 'bun'],
    ['bun', 'cheese', 'patty', 'bacon', 'pickle', 'egg', 'onion', 'lettuce', 'cheese', 'patty', 'tomato', 'bacon', 'egg', 'cheese', 'bun'],
    ['bun', 'lettuce', 'pickle', 'onion', 'tomato', 'patty', 'cheese', 'bacon', 'egg', 'patty', 'cheese', 'lettuce', 'bacon', 'pickle', 'onion', 'bun']
];

const customerAvatars = [
    { name: 'ÏßÅÏû•Ïù∏', skinTone: '#FFE4C4', shirtColor: 'linear-gradient(135deg, #667eea 0%, #764ba2 100%)', hair: 'short', hairColor: '#4A3728', accessory: 'glasses' },
    { name: 'ÌïôÏÉù', skinTone: '#FFDAB9', shirtColor: 'linear-gradient(135deg, #f093fb 0%, #f5576c 100%)', hair: 'ponytail', hairColor: '#8B4513', accessory: 'ribbon' },
    { name: 'ÏöîÎ¶¨ÏÇ¨', skinTone: '#F5DEB3', shirtColor: 'linear-gradient(135deg, #FFFFFF 0%, #E8E8E8 100%)', hair: 'short', hairColor: '#654321', accessory: 'hat' },
    { name: 'Ïö¥ÎèôÏÑ†Ïàò', skinTone: '#DEB887', shirtColor: 'linear-gradient(135deg, #fa709a 0%, #fee140 100%)', hair: 'sporty', hairColor: '#2C1810', accessory: 'headband' },
    { name: 'ÏïÑÌã∞Ïä§Ìä∏', skinTone: '#FFDAB9', shirtColor: 'linear-gradient(135deg, #a8edea 0%, #fed6e3 100%)', hair: 'messy', hairColor: '#C4A57B', accessory: 'beret' },
    { name: 'Ìï†Î®∏Îãà', skinTone: '#F5DEB3', shirtColor: 'linear-gradient(135deg, #d299c2 0%, #fef9d7 100%)', hair: 'bun', hairColor: '#C0C0C0', accessory: 'glasses' },
    { name: 'ÌûôÏä§ÌÑ∞', skinTone: '#E8C5A0', shirtColor: 'linear-gradient(135deg, #ffecd2 0%, #fcb69f 100%)', hair: 'undercut', hairColor: '#8B7355', accessory: 'beard' },
    { name: 'ÌïôÏÉù2', skinTone: '#FFE4C4', shirtColor: 'linear-gradient(135deg, #ff9a9e 0%, #fecfef 100%)', hair: 'bob', hairColor: '#6B4423', accessory: 'bow' },
    { name: 'ÏÇ¨ÏóÖÍ∞Ä', skinTone: '#DEB887', shirtColor: 'linear-gradient(135deg, #2c3e50 0%, #34495e 100%)', hair: 'slick', hairColor: '#1C1C1C', accessory: 'tie' },
    { name: 'ÏïÑÏù¥', skinTone: '#FFDAB9', shirtColor: 'linear-gradient(135deg, #ffeaa7 0%, #fdcb6e 100%)', hair: 'curly', hairColor: '#D2691E', accessory: 'cap' }
];

let currentCustomer = null;
let previousCustomer = null;
let currentCustomerState = 'waiting';

const praiseMessages = [
    'ÏïåÎ∞îÏÉùÏù¥ Î©ãÏûàÏñ¥Ïöî! üòç',
    'Ïã§Î†•Ïù¥ ÎåÄÎã®Ìï¥Ïöî! üåü',
    'ÏÜêÏù¥ ÏóÑÏ≤≠ Îπ†Î•¥ÎÑ§Ïöî! ‚ö°',
    'Ï≤úÏû¨ ÏïÑÎãàÏÑ∏Ïöî? ü§©',
    'Ïó¨Í∏∞ ÏïåÎ∞îÏÉù ÏµúÍ≥†! üëç',
    'ÏôÑÎ≤ΩÌï¥Ïöî! ÏÇ¨ÎûëÌï¥Ïöî! üíï',
    'Ï†úÍ∞Ä Î≥∏ Ï§ëÏóê ÏµúÍ≥†ÏòàÏöî! üèÜ',
    'ÌîÑÎ°ú ÎäêÎÇå ÎÇòÎäîÎç∞Ïöî? üòé',
    'Ïû•Ïù∏Ïù¥Ïã≠ÎãàÎã§! üî•',
    'Ïù¥ Í∞ÄÍ≤å ÎßõÏßë Ïù∏Ï†ï! üòã',
    'ÏπúÍµ¨Îì§ÌïúÌÖå Ï∂îÏ≤úÌï†Í≤åÏöî! üôå',
    'Îß§Ïùº Ïò¨Í≤åÏöî! Í∞êÏÇ¨Ìï¥Ïöî! üôè',
    'Ï†ïÎßê ÎßõÏûàÏñ¥Ïöî! ÏµúÍ≥†! ‚ú®',
    'Ïó¨Í∏∞ÏÑú ÏùºÌïòÍ≥† Ïã∂Ïñ¥Ïöî! üíº',
    'Îã§ÏùåÏóêÎèÑ Íº≠ ÏôÄÏïºÏßÄ! üëè',
    'Ïù¥ Ï†ïÎèÑÎ©¥ ÎØ∏ÏäêÎû≠Ïù¥Ï£†! ‚≠ê',
    'ÏßÑÏßú Ï∞ê ÎßõÏßëÏù¥ÎÑ§Ïöî! üéâ',
    'ÎÑàÎ¨¥ ÏπúÏ†àÌïòÏÑ∏Ïöî! üíñ',
    'Ïã§Î†•Ïù¥ ÏòàÏà†Ïù¥ÏóêÏöî! üé®',
    '5ÏÑ±Í∏â ÏÑúÎπÑÏä§ÎÑ§Ïöî! üåüüåüüåü',
    'Ïù¥Í≤å Î∞îÎ°ú Ïû•Ïù∏Ï†ïÏã†! ‚öíÔ∏è',
    'ÏôÑÏ†Ñ Í∞êÎèôÏù¥ÏóêÏöî! üò≠',
    'Ïó≠Ïãú ÌîÑÎ°úÎäî Îã§Î•¥Íµ∞Ïöî! üí™',
    'Ïó¨Í∏∞Í∞Ä Ï≤úÍµ≠Ïù∏Í∞ÄÎ¥êÏöî! ü§ó',
    'ÌèâÏÉù Îã®Í≥®Ìï†Í≤åÏöî! üéØ'
];

function startGame() {
    console.log('üéÆ startGame Ìò∏Ï∂úÎê®');
    const nicknameInput = document.getElementById('nicknameInput');
    const nickname = nicknameInput.value.trim();
    console.log('ÎãâÎÑ§ÏûÑ:', nickname);

    gameState = {
        nickname: nickname,
        score: 0,
        level: 1,
        combo: 0,
        maxCombo: 0,
        totalBurgers: 0,
        mistakes: 0,
        usedRecipes: [],
        currentOrder: [],
        currentSides: [],
        playerBurger: [],
        playerSides: [],
        selectedIngredientIndex: 0,
        isPlaying: true,
        isSubmitting: false,
        patienceTimer: null,
        patienceValue: 100,
        patienceDecreaseRate: 1.2,
        hasShownWarningMessage: false,
        hasShownUrgentMessage: false,
        shouldShowRushMessages: Math.random() < 0.4,
        usedPraiseMessages: []
    };

    showScreen('gameScreen');
    updateUI();

    // Ï≤òÏùå ÏãúÏûëÌï† ÎïåÎäî Ïï†ÎãàÎ©îÏù¥ÏÖò ÏóÜÏù¥ Ïû¨Î£å ÌëúÏãú
    const container = document.getElementById('ingredientsContainer');
    container.style.animation = 'none';
    renderIngredients();

    generateNewOrder();
    setupKeyboardControls();
}

function showScreen(screenId) {
    document.querySelectorAll('.screen').forEach(screen => {
        screen.classList.add('hidden');
    });
    document.getElementById(screenId).classList.remove('hidden');
}

function renderIngredients() {
    const container = document.getElementById('ingredientsContainer');
    container.innerHTML = '';

    // ÏÇ¨Ïù¥Îìú Ïú†Î¨¥Ïóê Îî∞Îùº ÌÅ¥ÎûòÏä§ Ï∂îÍ∞Ä/Ï†úÍ±∞
    if (gameState.totalBurgers >= 4) {
        container.classList.add('with-sides');
    } else {
        container.classList.remove('with-sides');
    }

    ingredients.forEach((ingredient, index) => {
        const slot = document.createElement('div');
        slot.className = 'ingredient-slot';
        slot.setAttribute('data-ingredient', ingredient.id);
        if (index === gameState.selectedIngredientIndex) {
            slot.classList.add('selected');
        }

        slot.innerHTML = `
            <div class="ingredient-icon">${ingredient.visual}</div>
            <div class="ingredient-label">${ingredient.name}</div>
        `;

        slot.onclick = () => selectIngredient(index);
        slot.ontouchend = (e) => {
            e.preventDefault();
            selectIngredient(index);
        };
        container.appendChild(slot);
    });

    if (gameState.totalBurgers >= 4) {
        sideItems.forEach((item, index) => {
            const slot = document.createElement('div');
            slot.className = 'ingredient-slot side-slot';
            const sideIndex = ingredients.length + index;
            if (sideIndex === gameState.selectedIngredientIndex) {
                slot.classList.add('selected');
            }

            slot.innerHTML = `
                <div class="ingredient-icon">${item.visual}</div>
                <div class="ingredient-label">${item.name}</div>
            `;

            slot.onclick = () => selectIngredient(sideIndex);
            slot.ontouchend = (e) => {
                e.preventDefault();
                selectIngredient(sideIndex);
            };
            container.appendChild(slot);
        });
    }
}

function selectIngredient(index) {
    gameState.selectedIngredientIndex = index;
    renderIngredients();

    if (isMobile()) {
        addSelectedIngredient();
    }
}

function isMobile() {
    return window.innerWidth <= 768 ||
           ('ontouchstart' in window) ||
           (navigator.maxTouchPoints > 0);
}

function shuffleIngredients() {
    for (let i = ingredients.length - 1; i > 0; i--) {
        const j = Math.floor(Math.random() * (i + 1));
        [ingredients[i], ingredients[j]] = [ingredients[j], ingredients[i]];
    }

    gameState.selectedIngredientIndex = 0;
    renderIngredients();

    const container = document.getElementById('ingredientsContainer');
    container.style.animation = 'none';
    setTimeout(() => {
        container.style.animation = 'ingredientShuffle 0.3s ease';
    }, 10);
}

// ÏÜêÎãò Ï∫êÎ¶≠ÌÑ∞ Í∑∏Î£π Ï†ïÏùò
const customers = [
    {
        waiting: 'customer-waiting.png',
        impatient: 'customer-impatient.png',
        success: 'customer-success.png'
    },
    {
        waiting: 'customer-waiting-new.png',
        impatient: 'customer-angry-new.png',
        success: 'customer-happy-new.png'
    },
    {
        waiting: 'customer3-waiting.png',
        impatient: 'customer3-angry.png',
        success: 'customer3-happy.png'
    },
    {
        waiting: 'customer4-waiting.png',
        impatient: 'customer4-angry.png',
        success: 'customer4-happy.png'
    },
    {
        waiting: 'customer5-waiting.png',
        impatient: 'customer5-angry.png',
        success: 'customer5-happy.png'
    },
    {
        waiting: 'customer6-waiting.png',
        impatient: 'customer6-angry.png',
        success: 'customer6-happy.png'
    },
    {
        waiting: 'customer7-waiting.png',
        impatient: 'customer7-angry.png',
        success: 'customer7-happy.png'
    }
];

function randomizeCustomer() {
    // ÏÉà ÏÜêÎãòÏù¥ ÏôîÏùÑ Îïå ÎûúÎç§ÏúºÎ°ú Ï∫êÎ¶≠ÌÑ∞ ÏÑ†ÌÉù (Ïù¥Ï†Ñ Ï∫êÎ¶≠ÌÑ∞ Ï†úÏô∏)
    let availableCustomers = customers;

    // Ïù¥Ï†Ñ Ï∫êÎ¶≠ÌÑ∞Í∞Ä ÏûàÏúºÎ©¥ Ï†úÏô∏
    if (previousCustomer && customers.length > 1) {
        availableCustomers = customers.filter(customer => customer !== previousCustomer);
    }

    // ÎûúÎç§ ÏÑ†ÌÉù
    currentCustomer = availableCustomers[Math.floor(Math.random() * availableCustomers.length)];
    previousCustomer = currentCustomer; // Îã§ÏùåÏùÑ ÏúÑÌï¥ Ï†ÄÏû•
    currentCustomerState = 'waiting';

    const customerImage = document.getElementById('customerImage');
    if (customerImage) {
        customerImage.src = currentCustomer.waiting;
        console.log('üé≠ ÏÜêÎãò ÏûÖÏû•:', currentCustomer.waiting);
    }
}

function logOrder() {
    console.log('\nüÜï ÏÉà Ï£ºÎ¨∏ ÏÉùÏÑ±Îê®:');
    console.log('ÌñÑÎ≤ÑÍ±∞:', gameState.currentOrder.map(id => {
        const ing = ingredients.find(i => i.id === id);
        return ing ? `${ing.name}(${id})` : id;
    }));
    if (gameState.currentSides.length > 0) {
        console.log('ÏÇ¨Ïù¥Îìú:', gameState.currentSides.map(id => {
            const side = sideItems.find(s => s.id === id);
            return side ? `${side.name}(${id})` : id;
        }));
    }
    console.log('ÏôÑÎ£åÌïú ÌñÑÎ≤ÑÍ±∞ Ïàò:', gameState.totalBurgers);
    console.log('---\n');
}

function generateNewOrder() {
    // Ïû¨Î£å Í∞úÏàòÎ•º Î†àÎ≤®Ïóê Îî∞Îùº ÎûúÎç§ÏúºÎ°ú ÏÉùÏÑ±
    let minIngredients, maxIngredients;
    if (gameState.level === 1) {
        minIngredients = 4;
        maxIngredients = 5;
    } else if (gameState.level === 2) {
        minIngredients = 5;
        maxIngredients = 6;
    } else if (gameState.level === 3) {
        minIngredients = 5;
        maxIngredients = 7;
    } else if (gameState.level <= 5) {
        minIngredients = 6;
        maxIngredients = 8;
    } else if (gameState.level <= 7) {
        minIngredients = 6;
        maxIngredients = 9;
    } else if (gameState.level <= 10) {
        minIngredients = 7;
        maxIngredients = 10;
    } else if (gameState.level <= 13) {
        minIngredients = 8;
        maxIngredients = 11;
    } else {
        minIngredients = 9;
        maxIngredients = 13;
    }

    // ÎûúÎç§ Ïû¨Î£å Í∞úÏàò Í≤∞Ï†ï
    const numIngredients = Math.floor(Math.random() * (maxIngredients - minIngredients + 1)) + minIngredients;

    // ÎπµÏùÑ Ï†úÏô∏Ìïú Ïû¨Î£å ÌíÄ
    const availableIngredients = ingredients.filter(ing => ing.id !== 'bun');

    // ÎûúÎç§ÌïòÍ≤å Ïû¨Î£å ÏÑ†ÌÉù
    gameState.currentOrder = ['bun']; // ÏïÑÎûò ÎπµÏúºÎ°ú ÏãúÏûë

    for (let i = 0; i < numIngredients - 2; i++) {
        const randomIngredient = availableIngredients[Math.floor(Math.random() * availableIngredients.length)];
        gameState.currentOrder.push(randomIngredient.id);
    }

    gameState.currentOrder.push('bun'); // ÏúÑ ÎπµÏúºÎ°ú ÎÅù

    gameState.currentSides = [];
    if (gameState.totalBurgers >= 4) {
        if (Math.random() < 0.3) {
            const randomSide = sideItems[Math.floor(Math.random() * sideItems.length)];
            gameState.currentSides.push(randomSide.id);
        }
    }

    gameState.playerBurger = [];
    gameState.playerSides = [];
    // ÏÇ¨Ïù¥ÎìúÍ∞Ä ÏûàÏúºÎ©¥ Ïù∏ÎÇ¥Ïã¨ 0.1Ï¥à Îçî Ï∂îÍ∞Ä
    if (gameState.currentSides.length > 0) {
        gameState.patienceValue = 100 + gameState.patienceDecreaseRate;
    } else {
        gameState.patienceValue = 100;
    }
    gameState.selectedIngredientIndex = 0;

    const customer = document.getElementById('customer');
    const speechBubble = document.querySelector('.speech-bubble');
    customer.style.animation = '';
    speechBubble.style.animation = '';
    speechBubble.style.opacity = '1';
    setTimeout(() => {
        customer.style.animation = 'customerEnter 0.5s ease';
    }, 10);

    renderOrder();
    renderPlayerBurger();

    // ÏÉà Ï£ºÎ¨∏ ÏãúÏûëÌï† ÎïåÎäî Ïï†ÎãàÎ©îÏù¥ÏÖò ÏóÜÏù¥ Ïû¨Î£å ÌëúÏãú
    const ingredientsContainer = document.getElementById('ingredientsContainer');
    ingredientsContainer.style.animation = 'none';
    renderIngredients();

    randomizeCustomer();
    startPatienceTimer();
    logOrder();

    // ÌÇ§ ÏûÖÎ†• Îã§Ïãú ÌôúÏÑ±Ìôî Î∞è Ïû¨Ï¥â Î©îÏãúÏßÄ ÌîåÎûòÍ∑∏ Î¶¨ÏÖã
    gameState.isSubmitting = false;
    gameState.hasShownWarningMessage = false;
    gameState.hasShownUrgentMessage = false;
    // 2~3Î≤àÏóê ÌïúÎ≤àÏî© Ïû¨Ï¥â Î©îÏãúÏßÄ ÌëúÏãú (40% ÌôïÎ•†)
    gameState.shouldShowRushMessages = Math.random() < 0.4;
}

function renderOrder() {
    const orderBurger = document.getElementById('orderBurger');
    orderBurger.innerHTML = '';

    const burgerContainer = document.createElement('div');
    burgerContainer.style.display = 'flex';
    burgerContainer.style.flexDirection = 'row';
    burgerContainer.style.alignItems = 'center';
    burgerContainer.style.gap = '5px';

    gameState.currentOrder.forEach(ingredientId => {
        const ingredient = ingredients.find(ing => ing.id === ingredientId);

        const ingredientEl = document.createElement('div');
        ingredientEl.className = 'order-ingredient';
        ingredientEl.textContent = ingredient.visual;

        burgerContainer.appendChild(ingredientEl);
    });

    gameState.currentSides.forEach(sideId => {
        const side = sideItems.find(s => s.id === sideId);

        const sideEl = document.createElement('div');
        sideEl.className = 'order-ingredient order-side';
        sideEl.textContent = side.visual;

        burgerContainer.appendChild(sideEl);
    });

    orderBurger.appendChild(burgerContainer);
}

function renderPlayerBurger(isNewIngredient = false) {
    const burgerBuilding = document.getElementById('burgerBuilding');
    burgerBuilding.innerHTML = '';

    // Ï†ÑÏ≤¥ Ïª®ÌÖåÏù¥ÎÑàÎ•º Í∞ÄÎ°úÎ°ú Î∞∞Ïπò
    const mainContainer = document.createElement('div');
    mainContainer.style.display = 'flex';
    mainContainer.style.flexDirection = 'row';
    mainContainer.style.alignItems = 'flex-end';
    mainContainer.style.justifyContent = 'center';
    mainContainer.style.gap = '15px';

    const burgerContainer = document.createElement('div');
    burgerContainer.style.display = 'flex';
    burgerContainer.style.flexDirection = 'row';
    burgerContainer.style.alignItems = 'center';
    burgerContainer.style.gap = '5px';

    gameState.playerBurger.forEach((ingredientId, index) => {
        const ingredient = ingredients.find(ing => ing.id === ingredientId);
        const ingredientEl = document.createElement('div');
        ingredientEl.className = 'building-ingredient';

        // ÎßàÏßÄÎßâ Ïû¨Î£åÏù¥Í≥† ÏÉàÎ°ú Ï∂îÍ∞ÄÎêú Í≤ΩÏö∞ÏóêÎßå Ïï†ÎãàÎ©îÏù¥ÏÖò Ï†ÅÏö©
        if (isNewIngredient && index === gameState.playerBurger.length - 1) {
            ingredientEl.classList.add('new-ingredient');
        }

        ingredientEl.textContent = ingredient.visual;
        burgerContainer.appendChild(ingredientEl);
    });

    mainContainer.appendChild(burgerContainer);

    if (gameState.playerSides.length > 0) {
        const sideContainer = document.createElement('div');
        sideContainer.style.display = 'flex';
        sideContainer.style.flexDirection = 'column';
        sideContainer.style.alignItems = 'center';
        sideContainer.style.gap = '5px';

        gameState.playerSides.forEach(sideId => {
            const side = sideItems.find(s => s.id === sideId);
            const sideEl = document.createElement('div');
            sideEl.className = 'building-ingredient building-side';
            sideEl.textContent = side.visual;
            sideContainer.appendChild(sideEl);
        });

        mainContainer.appendChild(sideContainer);
    }

    burgerBuilding.appendChild(mainContainer);
}

function startPatienceTimer() {
    if (gameState.patienceTimer) {
        clearInterval(gameState.patienceTimer);
    }

    gameState.patienceTimer = setInterval(() => {
        gameState.patienceValue -= gameState.patienceDecreaseRate;

        if (gameState.patienceValue <= 0) {
            gameState.patienceValue = 0;
            clearInterval(gameState.patienceTimer);
            customerLeft();
        }

        updatePatienceBar();
    }, 110);
}

function updatePatienceBar() {
    const fill = document.getElementById('patienceFill');
    fill.style.width = gameState.patienceValue + '%';

    fill.classList.remove('warning', 'danger');
    if (gameState.patienceValue <= 40) {
        fill.classList.add('danger');
        updateCustomerFace('angry');

        // 40% Ïù¥ÌïòÏùº Îïå Ïû¨Ï¥â Î©îÏãúÏßÄ (Ïù¥Î≤à Ï£ºÎ¨∏ÏóêÏÑúÎßå ÌëúÏãú)
        if (gameState.shouldShowRushMessages && !gameState.hasShownUrgentMessage) {
            const urgentMessages = ['Îπ®Î¶¨ Ìï¥Ï£ºÏÑ∏Ïöî! ‚è∞', 'ÏãúÍ∞ÑÏù¥ ÏóÜÏñ¥Ïöî! üò§', 'ÏÑúÎëêÎ•¥ÏÑ∏Ïöî! üí¢'];
            const message = urgentMessages[Math.floor(Math.random() * urgentMessages.length)];
            showPraiseBubble(message, 1700);
            gameState.hasShownUrgentMessage = true;
        }
    } else if (gameState.patienceValue <= 70) {
        fill.classList.add('warning');
        updateCustomerFace('neutral');

        // 70% Ïù¥ÌïòÏùº Îïå Ïû¨Ï¥â Î©îÏãúÏßÄ (Ïù¥Î≤à Ï£ºÎ¨∏ÏóêÏÑúÎßå ÌëúÏãú)
        if (gameState.shouldShowRushMessages && !gameState.hasShownWarningMessage) {
            const warningMessages = ['Ï°∞Í∏àÎßå ÏÑúÎëòÎü¨Ï£ºÏÑ∏Ïöî üôè', 'ÏãúÍ∞ÑÏù¥ Î≥ÑÎ°ú ÏóÜÏñ¥Ïöî ‚è±Ô∏è', 'Îπ®Î¶¨ Î∂ÄÌÉÅÌï¥Ïöî üòÖ'];
            const message = warningMessages[Math.floor(Math.random() * warningMessages.length)];
            showPraiseBubble(message, 1700);
            gameState.hasShownWarningMessage = true;
        }
    } else {
        updateCustomerFace('neutral');
    }
}

function updateCustomerFace(mood) {
    const customerImage = document.getElementById('customerImage');

    if (!customerImage || !currentCustomer) {
        console.warn('‚ö†Ô∏è customerImage ÎòêÎäî currentCustomerÍ∞Ä ÏóÜÏùå');
        return;
    }

    console.log('üòä ÏÜêÎãò ÌëúÏ†ï Î≥ÄÍ≤Ω:', mood);

    if (mood === 'happy') {
        // ÏÑ±Í≥µ! ÌñÑÎ≤ÑÍ±∞ Îì§Í≥† ÏûàÎäî Ïù¥ÎØ∏ÏßÄÎ°ú Î≥ÄÍ≤Ω
        currentCustomerState = 'success';
        console.log('üéâ ÏÑ±Í≥µ Ïù¥ÎØ∏ÏßÄÎ°ú Î≥ÄÍ≤Ω:', currentCustomer.success);
        customerImage.src = currentCustomer.success;
    } else if (mood === 'angry') {
        // Ïò§Îûò Í±∏Î†§ÏÑú ÏßúÏ¶ùÎÇ® - ÏßúÏ¶ùÎÇòÎäî Ïù¥ÎØ∏ÏßÄ
        currentCustomerState = 'impatient';
        console.log('üò† ÏßúÏ¶ù Ïù¥ÎØ∏ÏßÄÎ°ú Î≥ÄÍ≤Ω:', currentCustomer.impatient);
        customerImage.src = currentCustomer.impatient;
    } else if (mood === 'neutral') {
        // ÎåÄÍ∏∞ - Í∏∞Îã§Î¶¨Îäî Ïù¥ÎØ∏ÏßÄ
        currentCustomerState = 'waiting';
        console.log('üòê ÎåÄÍ∏∞ Ïù¥ÎØ∏ÏßÄÎ°ú Î≥ÄÍ≤Ω:', currentCustomer.waiting);
        customerImage.src = currentCustomer.waiting;
    }
}

function setupKeyboardControls() {
    document.addEventListener('keydown', handleKeyPress);
}

function handleKeyPress(e) {
    if (!gameState.isPlaying || gameState.isSubmitting) return;

    switch(e.key) {
        case 'ArrowLeft':
            e.preventDefault();
            moveSelection(-1);
            break;
        case 'ArrowRight':
            e.preventDefault();
            moveSelection(1);
            break;
        case 'ArrowUp':
            e.preventDefault();
            const colsUp = gameState.totalBurgers >= 4 ? 6 : 5;
            moveSelection(-colsUp);
            break;
        case 'ArrowDown':
            e.preventDefault();
            const colsDown = gameState.totalBurgers >= 4 ? 6 : 5;
            moveSelection(colsDown);
            break;
        case ' ':
            e.preventDefault();
            addSelectedIngredient();
            break;
        case 'Enter':
            e.preventDefault();
            submitBurger();
            break;
        case 'Backspace':
            e.preventDefault();
            undoIngredient();
            break;
    }
}

function moveSelection(direction) {
    gameState.selectedIngredientIndex += direction;

    const totalItems = gameState.totalBurgers >= 4
        ? ingredients.length + sideItems.length
        : ingredients.length;

    if (gameState.selectedIngredientIndex < 0) {
        gameState.selectedIngredientIndex = totalItems - 1;
    } else if (gameState.selectedIngredientIndex >= totalItems) {
        gameState.selectedIngredientIndex = 0;
    }

    renderIngredients();
}

function addSelectedIngredient() {
    if (gameState.selectedIngredientIndex < ingredients.length) {
        const selectedIngredient = ingredients[gameState.selectedIngredientIndex];
        gameState.playerBurger.push(selectedIngredient.id);
        console.log('ÌñÑÎ≤ÑÍ±∞ Ïû¨Î£å Ï∂îÍ∞Ä:', selectedIngredient.id);
    } else {
        const sideIndex = gameState.selectedIngredientIndex - ingredients.length;
        const selectedSide = sideItems[sideIndex];
        gameState.playerSides.push(selectedSide.id);
        console.log('ÏÇ¨Ïù¥Îìú Ïû¨Î£å Ï∂îÍ∞Ä:', selectedSide.id);
    }

    renderPlayerBurger(true);

    const slot = document.querySelectorAll('.ingredient-slot')[gameState.selectedIngredientIndex];
    if (slot) {
        slot.style.transform = 'scale(1.2)';
        setTimeout(() => {
            slot.style.transform = '';
        }, 200);
    }
}

function undoIngredient() {
    if (gameState.playerSides.length > 0) {
        gameState.playerSides.pop();
    } else if (gameState.playerBurger.length > 0) {
        gameState.playerBurger.pop();
    }
    renderPlayerBurger();
}

function submitBurger() {
    if (gameState.playerBurger.length === 0 || gameState.isSubmitting) {
        return;
    }

    gameState.isSubmitting = true;

    // ÎßêÌíçÏÑ† Ï¶âÏãú Ïà®Í∏∞Í∏∞
    const speechBubble = document.querySelector('.speech-bubble');
    if (speechBubble) {
        speechBubble.style.opacity = '0';
    }

    console.log('\n========== Ï†úÏ∂ú ==========');
    console.log('üìã Ï£ºÎ¨∏:');
    console.log('  ÌñÑÎ≤ÑÍ±∞:', gameState.currentOrder.map(id => {
        const ing = ingredients.find(i => i.id === id);
        return ing ? `${ing.name}(${id})` : id;
    }));
    if (gameState.currentSides.length > 0) {
        console.log('  ÏÇ¨Ïù¥Îìú:', gameState.currentSides.map(id => {
            const side = sideItems.find(s => s.id === id);
            return side ? `${side.name}(${id})` : id;
        }));
    }
    console.log('\nüë®‚Äçüç≥ Ï†úÏûë:');
    console.log('  ÌñÑÎ≤ÑÍ±∞:', gameState.playerBurger.map(id => {
        const ing = ingredients.find(i => i.id === id);
        return ing ? `${ing.name}(${id})` : id;
    }));
    if (gameState.playerSides.length > 0) {
        console.log('  ÏÇ¨Ïù¥Îìú:', gameState.playerSides.map(id => {
            const side = sideItems.find(s => s.id === id);
            return side ? `${side.name}(${id})` : id;
        }));
    }
    console.log('==========================\n');

    clearInterval(gameState.patienceTimer);

    const result = checkBurgerAccuracy();

    if (result.perfect) {
        handlePerfectBurger();
    } else if (result.correct) {
        handleCorrectBurger(result);
    } else {
        handleWrongBurger();
    }

    if (result.perfect || result.correct) {
        // Î∂ÑÌôçÏÉâ ÎßêÌíçÏÑ†Ïù¥ ÏÇ¨ÎùºÏßÑ ÌõÑ (850ms) +ÏõêÍ≥º Ìï®Íªò Ï∫êÎ¶≠ÌÑ∞ Ïª§ÏßÄÍ∏∞ ÏãúÏûë
        setTimeout(() => {
            if (gameState.isPlaying) {
                const customer = document.getElementById('customer');
                customer.style.animation = 'customerLeaveHappy 0.85s ease-out';

                // +ÏõêÏù¥ ÏÇ¨ÎùºÏßÄÎäî ÏãúÍ∞ÑÍ≥º Ï∫êÎ¶≠ÌÑ∞ ÏÇ¨ÎùºÏßÄÎäî ÏãúÍ∞Ñ ÌõÑÏóê ÏÉà Ï£ºÎ¨∏ ÏÉùÏÑ±
                setTimeout(() => {
                    gameState.totalBurgers++;
                    checkLevelUp();

                    if (gameState.totalBurgers % 3 === 0) {
                        shuffleIngredients();
                    }

                    customer.style.animation = '';
                    generateNewOrder();
                }, 850);
            }
        }, 850);
    }
}

function checkBurgerAccuracy() {
    console.log('=== ÌñÑÎ≤ÑÍ±∞ Ï≤¥ÌÅ¨ ===');
    console.log('Ï£ºÎ¨∏ ÌñÑÎ≤ÑÍ±∞:', gameState.currentOrder);
    console.log('Ï†úÏûë ÌñÑÎ≤ÑÍ±∞:', gameState.playerBurger);

    if (gameState.playerBurger.length !== gameState.currentOrder.length) {
        console.log('ÌñÑÎ≤ÑÍ±∞ Í∞úÏàò Î∂àÏùºÏπò');
        return { perfect: false, correct: false, accuracy: 0 };
    }

    let correctCount = 0;
    for (let i = 0; i < gameState.currentOrder.length; i++) {
        if (gameState.playerBurger[i] === gameState.currentOrder[i]) {
            correctCount++;
        } else {
            console.log(`Ïû¨Î£å ${i} Î∂àÏùºÏπò: ${gameState.playerBurger[i]} !== ${gameState.currentOrder[i]}`);
        }
    }

    const burgerAccuracy = correctCount / gameState.currentOrder.length;
    console.log('ÌñÑÎ≤ÑÍ±∞ Ï†ïÌôïÎèÑ:', burgerAccuracy);

    console.log('=== ÏÇ¨Ïù¥Îìú Ï≤¥ÌÅ¨ ===');
    console.log('Ï£ºÎ¨∏ ÏÇ¨Ïù¥Îìú:', gameState.currentSides);
    console.log('Ï†úÏûë ÏÇ¨Ïù¥Îìú:', gameState.playerSides);

    let sidesCorrect = true;
    if (gameState.currentSides.length !== gameState.playerSides.length) {
        console.log('ÏÇ¨Ïù¥Îìú Í∞úÏàò Î∂àÏùºÏπò');
        sidesCorrect = false;
    } else {
        // ÏàúÏÑú Î¨¥Í¥ÄÌïòÍ≤å Ìè¨Ìï® Ïó¨Î∂ÄÎßå Ï≤¥ÌÅ¨
        const sortedOrderSides = [...gameState.currentSides].sort();
        const sortedPlayerSides = [...gameState.playerSides].sort();
        for (let i = 0; i < sortedOrderSides.length; i++) {
            if (sortedOrderSides[i] !== sortedPlayerSides[i]) {
                console.log(`ÏÇ¨Ïù¥Îìú Î∂àÏùºÏπò: ${sortedPlayerSides[i]} !== ${sortedOrderSides[i]}`);
                sidesCorrect = false;
                break;
            }
        }
    }

    console.log('ÏÇ¨Ïù¥Îìú Ï†ïÌôï:', sidesCorrect);

    // 100% Ï†ïÌôïÌï¥ÏïºÎßå Ï†ïÎãµÏúºÎ°ú Ïù∏Ï†ï
    const isPerfect = burgerAccuracy === 1 && sidesCorrect;
    const isCorrect = burgerAccuracy === 1 && sidesCorrect;

    console.log('Í≤∞Í≥º - Perfect:', isPerfect, 'Correct:', isCorrect);

    return {
        perfect: isPerfect,
        correct: isCorrect,
        accuracy: burgerAccuracy,
        hasSide: gameState.currentSides.length > 0
    };
}

function handlePerfectBurger() {
    gameState.combo++;

    if (gameState.combo > gameState.maxCombo) {
        gameState.maxCombo = gameState.combo;
    }

    let tip;
    if (gameState.currentSides.length > 0) {
        tip = Math.floor(Math.random() * 11) + 10;
    } else {
        tip = Math.floor(Math.random() * 6) + 5;
    }
    gameState.score += tip;

    updateCustomerFace('happy');

    // ÏïÑÏßÅ ÏÇ¨Ïö©ÌïòÏßÄ ÏïäÏùÄ Ïπ≠Ï∞¨ Î©îÏãúÏßÄ ÏÑ†ÌÉù
    let availableMessages = praiseMessages.filter(msg => !gameState.usedPraiseMessages.includes(msg));

    // Î™®Îì† Î©îÏãúÏßÄÎ•º Îã§ ÏÇ¨Ïö©ÌñàÏúºÎ©¥ Î¶¨ÏÖã
    if (availableMessages.length === 0) {
        gameState.usedPraiseMessages = [];
        availableMessages = [...praiseMessages];
    }

    const praise = availableMessages[Math.floor(Math.random() * availableMessages.length)];
    gameState.usedPraiseMessages.push(praise);

    showPraiseBubble(praise);

    setTimeout(() => {
        showTipAnimation(tip);
    }, 850);

    updateUI();
}

function handleCorrectBurger(result) {
    let baseTip;
    if (result.hasSide) {
        baseTip = Math.floor(Math.random() * 11) + 10;
    } else {
        baseTip = Math.floor(Math.random() * 6) + 5;
    }
    const tip = Math.max(result.hasSide ? 10 : 5, Math.floor(baseTip * result.accuracy));
    gameState.score += tip;

    updateCustomerFace('happy');

    const goodMessages = ['Í¥úÏ∞ÆÏïÑÏöî üëå', 'Ï¢ãÏïÑÏöî! üòä', 'Í∞êÏÇ¨Ìï¥Ïöî üôÇ'];
    const praise = goodMessages[Math.floor(Math.random() * goodMessages.length)];

    showPraiseBubble(praise);

    setTimeout(() => {
        showTipAnimation(tip);
    }, 850);

    updateUI();
}

function handleWrongBurger() {
    gameState.combo = 0;
    gameState.mistakes++;

    if (gameState.mistakes >= 2) {
        updateCustomerFace('angry');

        const customer = document.getElementById('customer');
        customer.style.animation = 'customerLeave 1s ease-out forwards';

        setTimeout(() => {
            gameOver();
        }, 1000);
    } else {
        updateCustomerFace('angry');

        const warningMessages = ['Ï°∞Ïã¨ÌïòÏÑ∏Ïöî! ‚ö†Ô∏è', 'Ìïú Î≤àÎßå Îçî ÌãÄÎ¶¨Î©¥...üò∞', 'Îã§Ïãú Ìï¥Ï£ºÏÑ∏Ïöî! üôè'];
        const warning = warningMessages[Math.floor(Math.random() * warningMessages.length)];
        showPraiseBubble(warning, 1400);

        // ÎßêÌíçÏÑ†Ïù¥ ÏÇ¨ÎùºÏßÑ ÌõÑ 0.2Ï¥à Îí§Ïóê Ï∫êÎ¶≠ÌÑ∞Í∞Ä ÏÇ¨ÎùºÏßÄÎèÑÎ°ù 0.6Ï¥à ÏãúÏ†êÏóê Ï∫êÎ¶≠ÌÑ∞ Ïï†ÎãàÎ©îÏù¥ÏÖò ÏãúÏûë
        setTimeout(() => {
            if (gameState.isPlaying) {
                const customer = document.getElementById('customer');
                customer.style.animation = 'customerLeaveHappy 1s ease-out';

                setTimeout(() => {
                    customer.style.animation = '';
                    shuffleIngredients();
                    generateNewOrder();
                }, 1000);
            }
        }, 600);
    }
}

function showPraiseBubble(message, duration = 850) {
    const customerArea = document.querySelector('.customer-area');

    // Í∏∞Ï°¥ ÎßêÌíçÏÑ†Ïù¥ ÏûàÏúºÎ©¥ Î®ºÏ†Ä Ï†úÍ±∞
    const existingBubbles = customerArea.querySelectorAll('.praise-bubble');
    existingBubbles.forEach(bubble => bubble.remove());

    const bubbleEl = document.createElement('div');
    bubbleEl.className = 'praise-bubble';
    bubbleEl.innerHTML = `
        ${message}
        <svg class="tail" viewBox="0 0 30 24" fill="none">
            <path d="M0 0 Q 5 0, 8 8 Q 12 20, 28 22"
                  stroke="#FF69B4"
                  stroke-width="4"
                  fill="none"
                  stroke-linecap="round"/>
            <path d="M2 0 L2 0 Q 6 2, 9 10 Q 12 18, 26 20 L30 0 Z"
                  fill="white"/>
        </svg>
    `;

    customerArea.appendChild(bubbleEl);

    setTimeout(() => {
        bubbleEl.remove();
    }, duration);
}

function showTipAnimation(tip) {
    const customerArea = document.querySelector('.customer-area');
    const tipEl = document.createElement('div');
    tipEl.className = 'tip-animation';
    tipEl.textContent = 'üí∞ +' + tip + 'Ïõê';

    customerArea.appendChild(tipEl);

    setTimeout(() => {
        tipEl.remove();
    }, 1000);
}

function customerLeft() {
    gameState.combo = 0;
    gameState.mistakes++;

    if (gameState.mistakes >= 2) {
        updateCustomerFace('angry');

        // ÎßêÌíçÏÑ† Î®ºÏ†Ä ÏÇ¨ÎùºÏßÄÍ≤å
        const speechBubble = document.querySelector('.speech-bubble');
        speechBubble.style.animation = 'speechBubbleFadeOut 0.4s ease-out forwards';

        setTimeout(() => {
            const customer = document.getElementById('customer');
            customer.style.animation = 'customerLeave 1s ease-out forwards';

            setTimeout(() => {
                gameOver();
            }, 1000);
        }, 400);
    } else {
        updateCustomerFace('angry');

        // 2~3Î≤àÏóê ÌïúÎ≤àÏî©Îßå Ïû¨Ï¥â Î©îÏãúÏßÄ ÌëúÏãú (40% ÌôïÎ•†)
        if (Math.random() < 0.4) {
            const warningMessages = ['Îπ®Î¶¨ Ìï¥Ï£ºÏÑ∏Ïöî! ‚è∞', 'ÏãúÍ∞ÑÏù¥ ÏóÜÏñ¥Ïöî! üò§', 'ÏÑúÎëêÎ•¥ÏÑ∏Ïöî! üí¢'];
            const warning = warningMessages[Math.floor(Math.random() * warningMessages.length)];
            showPraiseBubble(warning, 1700);
        }

        setTimeout(() => {
            if (gameState.isPlaying) {
                // ÎßêÌíçÏÑ† Î®ºÏ†Ä ÏÇ¨ÎùºÏßÄÍ≤å
                const speechBubble = document.querySelector('.speech-bubble');
                speechBubble.style.animation = 'speechBubbleFadeOut 0.4s ease-out forwards';

                setTimeout(() => {
                    const customer = document.getElementById('customer');
                    customer.style.animation = 'customerLeave 0.6s ease-out';

                    setTimeout(() => {
                        customer.style.animation = '';
                        speechBubble.style.animation = '';
                        shuffleIngredients();
                        generateNewOrder();
                    }, 600);
                }, 400);
            }
        }, 3000);
    }
}

function checkLevelUp() {
    const burgersNeeded = gameState.level * 2;

    if (gameState.totalBurgers >= burgersNeeded) {
        gameState.level++;

        if (gameState.level <= 3) {
            // Î†àÎ≤® 1-3Îäî ÏÜçÎèÑ Ïú†ÏßÄ (Ï¶ùÍ∞Ä ÏóÜÏùå)
        } else if (gameState.level <= 6) {
            gameState.patienceDecreaseRate += 0.2;
        } else if (gameState.level <= 10) {
            gameState.patienceDecreaseRate += 0.25;
        } else {
            gameState.patienceDecreaseRate += 0.3;
        }
    }
}

function updateUI() {
    document.getElementById('scoreValue').textContent = gameState.score + 'Ïõê';
    document.getElementById('levelValue').textContent = gameState.level;
    document.getElementById('comboValue').textContent = gameState.combo;
    const bottomScoreEl = document.getElementById('bottomScore');
    if (bottomScoreEl) {
        bottomScoreEl.textContent = gameState.score;
    }

    if (gameState.score >= 100) {
        gameState.isPlaying = false;
        clearInterval(gameState.patienceTimer);
        document.removeEventListener('keydown', handleKeyPress);
        setTimeout(() => {
            showGameClear();
        }, 1000);
    }
}

function gameOver() {
    gameState.isPlaying = false;
    clearInterval(gameState.patienceTimer);
    document.removeEventListener('keydown', handleKeyPress);

    saveToHallOfFame();

    showScreen('gameOverScreen');

    document.getElementById('finalScore').textContent = gameState.score + 'Ïõê';
    document.getElementById('finalLevel').textContent = gameState.level;
    document.getElementById('totalBurgers').textContent = gameState.totalBurgers;
    document.getElementById('maxCombo').textContent = gameState.maxCombo;
}

function showGameClear() {
    saveToHallOfFame();

    showScreen('gameClearScreen');

    document.getElementById('clearScore').textContent = gameState.score + 'Ïõê';
    document.getElementById('clearLevel').textContent = gameState.level;
    document.getElementById('clearBurgers').textContent = gameState.totalBurgers;
    document.getElementById('clearMaxCombo').textContent = gameState.maxCombo;
}

function restartGame() {
    showScreen('startScreen');
}

function saveToHallOfFame() {
    if (!gameState.nickname) {
        console.warn('‚ö†Ô∏è ÎãâÎÑ§ÏûÑÏù¥ ÏóÜÏñ¥ÏÑú Î™ÖÏòàÏùò Ï†ÑÎãπÏóê Ï†ÄÏû•ÌïòÏßÄ ÏïäÏäµÎãàÎã§.');
        return;
    }

    const record = {
        nickname: gameState.nickname,
        score: gameState.score,
        level: gameState.level,
        totalBurgers: gameState.totalBurgers,
        maxCombo: gameState.maxCombo,
        timestamp: Date.now(),
        date: new Date().toISOString()
    };

    console.log('üíæ FirebaseÏóê Í∏∞Î°ù Ï†ÄÏû•:', record);

    // FirebaseÏóê Ï†ÄÏû•
    try {
        const hallOfFameRef = window.firebaseRef(window.firebaseDB, 'hallOfFame');
        window.firebasePush(hallOfFameRef, record);
        console.log('‚úÖ Firebase Ï†ÄÏû• ÏôÑÎ£å!');
    } catch (error) {
        console.error('‚ùå Firebase Ï†ÄÏû• Ïã§Ìå®:', error);
        // Fallback: localStorageÏóê Ï†ÄÏû•
        let hallOfFame = JSON.parse(localStorage.getItem('burgerGameHallOfFame') || '[]');
        hallOfFame.push(record);
        hallOfFame.sort((a, b) => b.score - a.score);
        hallOfFame = hallOfFame.slice(0, 50);
        localStorage.setItem('burgerGameHallOfFame', JSON.stringify(hallOfFame));
        console.log('‚ö†Ô∏è localStorageÏóê Ï†ÄÏû•Îê® (Fallback)');
    }
}

function showHallOfFame() {
    showScreen('hallOfFameScreen');
    renderHallOfFame();
}

function renderHallOfFame() {
    const hallOfFameList = document.getElementById('hallOfFameList');
    hallOfFameList.innerHTML = '<div class="empty-hall-of-fame">Î°úÎî© Ï§ë... ‚è≥</div>';

    // FirebaseÏóêÏÑú Îç∞Ïù¥ÌÑ∞ Î∂àÎü¨Ïò§Í∏∞
    try {
        const hallOfFameRef = window.firebaseRef(window.firebaseDB, 'hallOfFame');
        const topScoresQuery = window.firebaseQuery(
            hallOfFameRef,
            window.firebaseOrderByChild('score'),
            window.firebaseLimitToLast(100)
        );

        window.firebaseOnValue(topScoresQuery, (snapshot) => {
            const hallOfFame = [];
            snapshot.forEach((childSnapshot) => {
                hallOfFame.push(childSnapshot.val());
            });

            // Ï†êÏàò ÎÇ¥Î¶ºÏ∞®Ïàú Ï†ïÎ†¨
            hallOfFame.sort((a, b) => b.score - a.score);

            // ÏÉÅÏúÑ 50Í∞úÎßå
            const top50 = hallOfFame.slice(0, 50);

            if (top50.length === 0) {
                hallOfFameList.innerHTML = '<div class="empty-hall-of-fame">ÏïÑÏßÅ Í∏∞Î°ùÏù¥ ÏóÜÏäµÎãàÎã§.<br>Ï≤´ Î≤àÏß∏ ÏïåÎ∞îÏÉùÏù¥ ÎêòÏñ¥Î≥¥ÏÑ∏Ïöî! üçî</div>';
                return;
            }

            hallOfFameList.innerHTML = top50.map((record, index) => {
                const rank = index + 1;
                let rankClass = '';
                let rankEmoji = '';

                if (rank === 1) {
                    rankClass = 'first';
                    rankEmoji = 'ü•á';
                } else if (rank === 2) {
                    rankClass = 'second';
                    rankEmoji = 'ü•à';
                } else if (rank === 3) {
                    rankClass = 'third';
                    rankEmoji = 'ü•â';
                } else {
                    rankEmoji = `#${rank}`;
                }

                const date = new Date(record.date);
                const dateStr = `${date.getMonth() + 1}/${date.getDate()}`;

                return `
                    <div class="hall-of-fame-item">
                        <div class="hall-of-fame-rank ${rankClass}">${rankEmoji}</div>
                        <div class="hall-of-fame-info">
                            <div class="hall-of-fame-name">${record.nickname}</div>
                            <div class="hall-of-fame-stats">
                                <div class="hall-of-fame-stat">üí∞ ${record.score}Ïõê</div>
                                <div class="hall-of-fame-stat">üìä Lv.${record.level}</div>
                                <div class="hall-of-fame-stat">üçî ${record.totalBurgers}Í∞ú</div>
                                <div class="hall-of-fame-stat">üî• ${record.maxCombo} ÏΩ§Î≥¥</div>
                                <div class="hall-of-fame-stat">üìÖ ${dateStr}</div>
                            </div>
                        </div>
                    </div>
                `;
            }).join('');

            console.log('üèÜ Î™ÖÏòàÏùò Ï†ÑÎãπ Î°úÎìú ÏôÑÎ£å:', top50.length, 'Í∞ú Í∏∞Î°ù');
        }, {
            onlyOnce: true
        });
    } catch (error) {
        console.error('‚ùå Firebase Î°úÎìú Ïã§Ìå®:', error);
        // Fallback: localStorageÏóêÏÑú Î∂àÎü¨Ïò§Í∏∞
        const hallOfFame = JSON.parse(localStorage.getItem('burgerGameHallOfFame') || '[]');

        if (hallOfFame.length === 0) {
            hallOfFameList.innerHTML = '<div class="empty-hall-of-fame">ÏïÑÏßÅ Í∏∞Î°ùÏù¥ ÏóÜÏäµÎãàÎã§.<br>Ï≤´ Î≤àÏß∏ ÏïåÎ∞îÏÉùÏù¥ ÎêòÏñ¥Î≥¥ÏÑ∏Ïöî! üçî</div>';
            return;
        }

        hallOfFameList.innerHTML = hallOfFame.map((record, index) => {
            const rank = index + 1;
            let rankClass = '';
            let rankEmoji = '';

            if (rank === 1) {
                rankClass = 'first';
                rankEmoji = 'ü•á';
            } else if (rank === 2) {
                rankClass = 'second';
                rankEmoji = 'ü•à';
            } else if (rank === 3) {
                rankClass = 'third';
                rankEmoji = 'ü•â';
            } else {
                rankEmoji = `#${rank}`;
            }

            const date = new Date(record.date);
            const dateStr = `${date.getMonth() + 1}/${date.getDate()}`;

            return `
                <div class="hall-of-fame-item">
                    <div class="hall-of-fame-rank ${rankClass}">${rankEmoji}</div>
                    <div class="hall-of-fame-info">
                        <div class="hall-of-fame-name">${record.nickname}</div>
                        <div class="hall-of-fame-stats">
                            <div class="hall-of-fame-stat">üí∞ ${record.score}Ïõê</div>
                            <div class="hall-of-fame-stat">üìä Lv.${record.level}</div>
                            <div class="hall-of-fame-stat">üçî ${record.totalBurgers}Í∞ú</div>
                            <div class="hall-of-fame-stat">üî• ${record.maxCombo} ÏΩ§Î≥¥</div>
                            <div class="hall-of-fame-stat">üìÖ ${dateStr}</div>
                        </div>
                    </div>
                </div>
            `;
        }).join('');
        console.log('‚ö†Ô∏è localStorageÏóêÏÑú Î°úÎìúÎê® (Fallback)');
    }
}

function backToStart() {
    showScreen('startScreen');
}

console.log('üçî ÌñÑÎ≤ÑÍ±∞ Í∞ÄÍ≤å Í≤åÏûÑ Ï§ÄÎπÑ ÏôÑÎ£å!');
console.log('üî• Firebase Í∏ÄÎ°úÎ≤å Î™ÖÏòàÏùò Ï†ÑÎãπ ÏÇ¨Ïö© Ï§ë!');
    </script>
</body>
</html>
